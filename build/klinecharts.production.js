!function(t,i){"object"===typeof exports&&"object"===typeof module?module.exports=i():"function"===typeof define&&define.amd?define("klinecharts",[],i):"object"===typeof exports?exports.klinecharts=i():t.klinecharts=i()}(window,function(){return function(t){var i={};function a(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=t,a.c=i,a.d=function(t,i,e){a.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,i){if(1&i&&(t=a(t)),8&i)return t;if(4&i&&"object"===typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(a.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)a.d(e,s,function(i){return t[i]}.bind(null,s));return e},a.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(i,"a",i),i},a.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},a.p="",a(a.s=0)}([function(t,i,a){"use strict";a.r(i);var e=class{constructor(){this.contentRect={left:0,right:0,top:0,bottom:0},this.viewHeight=0,this.viewWidth=0}setChartDimens(t,i){this.viewWidth=t,this.viewHeight=i,this.restrainViewPort(this.contentLeft(),this.contentTop(),t-this.contentRight(),i-this.contentBottom())}restrainViewPort(t,i,a,e){this.contentRect.left=t,this.contentRect.right=this.viewWidth-a,this.contentRect.top=i,this.contentRect.bottom=this.viewHeight-e}contentTop(){return this.contentRect.top}contentLeft(){return this.contentRect.left}contentRight(){return this.contentRect.right}contentBottom(){return this.contentRect.bottom}getContentCenter(){let t={};return t.x=(this.contentRect.left+this.contentRect.right)/2,t.y=(this.contentRect.top+this.contentRect.bottom)/2,t}isInBoundsX(t){return this.isInBoundsLeft(t)&&this.isInBoundsRight(t)}isInBoundsLeft(t){return this.contentRect.left<=t+1}isInBoundsRight(t){let i=+(100*t).toFixed(0)/100;return this.contentRect.right>=i-1}};var s=class{constructor(t){this.viewPortHandler=t,this.dataList=[],this.min=0,this.range=120,this.maxRange=180,this.minRange=20,this.dataSpace=0,this.dataMarginSpaceRate=.2,this.currentDataPos=0}space(){this.dataSpace=(this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft())/this.range}moveToLast(){this.dataList.length>this.range?(this.min=this.dataList.length-this.range,this.currentDataPos=this.dataList.length-1):this.min=0}calcCurrentDataIndex(t){let i=+Math.ceil((t-this.viewPortHandler.contentLeft())/this.dataSpace).toFixed(0);this.currentDataPos=this.min+i-1}};var o=class{constructor(t,i){this.dataBounds=t,this.viewPortHandler=i,this.chartTop=0,this.chartHeight=0}setChartDimens(t,i){this.chartHeight=t,this.chartTop=i}getY(t,i,a){return+(this.chartTop+(1-(t-i)/a)*this.chartHeight).toFixed(0)}};var r=class extends o{constructor(t,i,a){super(i,a),this.grid=t}draw(t){this.grid.display&&(t.strokeStyle=this.grid.lineColor,t.lineWidth=this.grid.lineSize,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop()+.5),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentTop()+.5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()+.5),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom()+.5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft()+.5,this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentLeft()+.5,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(this.viewPortHandler.contentRight()-.5,this.viewPortHandler.contentTop()),t.lineTo(this.viewPortHandler.contentRight()-.5,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath())}};var n={canvas:document.createElement("canvas").getContext("2d"),formatDate(t){let i=new Date(t),a=(i.getMonth()+1).toString(),e=i.getDate().toString(),s=i.getHours().toString(),o=i.getMinutes().toString();return(1===a.length?"0"+a:a)+"-"+(1===e.length?"0"+e:e)+" "+(1===s.length?"0"+s:s)+":"+(1===o.length?"0"+o:o)},calcTextWidth(t,i){return this.canvas.font=t,this.canvas.measureText(i).width},nice(t){let i=Math.floor(Math.log(t)/Math.log(10)),a=Math.pow(10,i),e=t/a,s=0;return t=(s=e<1?1:e<2?2:e<3?3:e<5?5:10)*a,i>=-20?+t.toFixed(i<0?-i:0):t},getIntervalPrecision(t){let i=t.toString(),a=i.indexOf("e");if(a>0){let t=+i.slice(a+1);return t<0?-t:0}{let t=i.indexOf(".");return t<0?0:i.length-1-t}},round:(t,i)=>(null==i&&(i=10),i=Math.min(Math.max(0,i),20),t=(+t).toFixed(i))};var h=class extends o{constructor(t,i){super(t,i),this.values=[],this.valueCount=0}computeAxisValues(t,i){let a=i-t;if(a<0)return this.values=[],void(this.valueCount=0);let e=+n.nice(a/5),s=n.getIntervalPrecision(e),o=+n.round(Math.ceil(t/e)*e,s),r=+n.round(Math.floor(i/e)*e,s),h=0,l=o;if(0!==e)for(;l<=+r;)++h,l+=e;this.valueCount=h,this.values=[];let d=0;for(l=o;d<h;)this.values[d]=l,l+=e,++d}};const l={NO:"NO",MA:"MA",VOL:"VOL",MACD:"MACD",BOLL:"BOLL",KDJ:"KDJ",KD:"KD",RSI:"RSI",BIAS:"BIAS",BRAR:"BRAR",CCI:"CCI",DMI:"DMI",CR:"CR",PSY:"PSY",DMA:"DMA",TRIX:"TRIX",OBV:"OBV",VR:"VR",WR:"WR",MTM:"MTM",EMV:"EMV",SAR:"SAR"};var d=class{constructor(){this.lineSize=1,this.increasingColor="#5DB300",this.decreasingColor="#FF4A4A",this.lineColors=["#898989","#F5A623","#F601FF","#1587DD","#50A300"]}};const c={DASH:"dash",SOLID:"solid"};var m=class{constructor(){this.display=!0,this.color="#707070",this.axisLine={display:!0,color:"#707070",size:1},this.tickText={display:!0,position:x.OUTSIDE,color:"#707070",size:12,margin:3,valueFormatter:null},this.tickLine={display:!0,size:3,color:"#707070"},this.separatorLine={display:!1,size:1,color:"#B8B8B8",style:c.DASH,dashValue:[8,8]}}};const u={LEFT:"left",RIGHT:"right"},x={OUTSIDE:"outside",INSIDE:"inside"};var g=class extends m{constructor(){super(),this.yAxisPosition=u.RIGHT,this.yAxisMaxWidth=80,this.yAxisMinWidth=40}needsOffset(){return((this.tickText.display||this.tickLine.display||this.tickText.margin>0)&&this.tickText.position===x.OUTSIDE||this.axisLine.display)&&this.display}getRequiredWidthSpace(){let t=0;if(this.tickText.position===x.OUTSIDE&&(t+=n.calcTextWidth(`${2*this.tickText.size}px Arial`,"0000000")+2*this.tickText.margin,this.display&&this.tickLine.display&&(t+=2*this.tickLine.size)),this.display&&this.axisLine.display&&(t+=this.axisLine.size),t===this.axisLine.size)return parseInt(t);let i=t;return i>0&&(i=2*this.yAxisMaxWidth,t=Math.min(i,Math.max(t,2*this.yAxisMinWidth))),parseInt(t)}};var v=class extends h{constructor(t,i,a){super(i,a),this.axisMaximum=0,this.axisMinimum=0,this.axisRange=0,this.yAxis=t}drawAxisLine(t){this.yAxis.display&&this.yAxis.axisLine.display&&(t.strokeStyle=this.yAxis.axisLine.color||this.yAxis.color,t.lineWidth=this.yAxis.axisLine.size,t.beginPath(),this.yAxis.yAxisPosition===u.LEFT?(t.moveTo(this.viewPortHandler.contentLeft()+.5,this.chartTop),t.lineTo(this.viewPortHandler.contentLeft()+.5,this.chartTop+this.chartHeight)):(t.moveTo(this.viewPortHandler.contentRight()+.5,this.chartTop),t.lineTo(this.viewPortHandler.contentRight()+.5,this.chartTop+this.chartHeight)),t.stroke(),t.closePath())}drawAxisLabels(t){if(!this.yAxis.display||!this.yAxis.tickText.display)return;let i;i=this.yAxis.yAxisPosition===u.LEFT?this.yAxis.tickText.position===x.OUTSIDE?this.yAxis.display&&this.yAxis.tickLine.display?this.viewPortHandler.contentLeft()-2*this.yAxis.tickLine.size-2*this.yAxis.tickText.margin:this.viewPortHandler.contentLeft()-2*this.yAxis.tickText.margin:this.yAxis.display&&this.yAxis.tickLine.display?this.viewPortHandler.contentLeft()+2*this.yAxis.tickLine.size+2*this.yAxis.tickText.margin:this.viewPortHandler.contentLeft()+2*this.yAxis.tickText.margin:this.yAxis.tickText.position===x.OUTSIDE?this.yAxis.display&&this.yAxis.tickLine.display?this.viewPortHandler.contentRight()+2*this.yAxis.tickLine.size+2*this.yAxis.tickText.margin:this.viewPortHandler.contentRight()+2*this.yAxis.tickText.margin:this.yAxis.display&&this.yAxis.tickLine.display?this.viewPortHandler.contentRight()-2*this.yAxis.tickLine.size-2*this.yAxis.tickText.margin:this.viewPortHandler.contentRight()-2*this.yAxis.tickText.margin,t.textBaseline="middle",t.font=2*this.yAxis.tickText.size+"px Arial",t.fillStyle=this.yAxis.tickText.color||this.yAxis.color;let a=2*this.yAxis.tickText.size,e=this.yAxis.tickText.valueFormatter;for(let s=0;s<this.values.length;s++){let o=this.getValueY(this.values[s]),r=this.values[s].toString();e&&(r=e(this.values[s])||"--"),this.checkShowLabel(o,a)&&(this.yAxis.yAxisPosition===u.LEFT&&this.yAxis.tickText.position===x.OUTSIDE||this.yAxis.yAxisPosition===u.RIGHT&&this.yAxis.tickText.position!==x.OUTSIDE?t.textAlign="right":t.textAlign="left",t.fillText(r,i,o))}t.textAlign="left"}drawSeparatorLines(t){if(!this.yAxis.display||!this.yAxis.separatorLine.display)return;t.strokeStyle=this.yAxis.separatorLine.color||this.yAxis.color,t.lineWidth=this.yAxis.separatorLine.size;let i=2*this.yAxis.tickText.size;this.yAxis.separatorLine.style===c.DASH&&t.setLineDash(this.yAxis.separatorLine.dashValue);for(let a=0;a<this.values.length;a++){let e=this.getValueY(this.values[a]);this.checkShowLabel(e,i)&&(t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),e+.5),t.lineTo(this.viewPortHandler.contentRight(),e+.5),t.stroke(),t.closePath())}t.setLineDash([])}drawTickLines(t){if(!this.yAxis.display||!this.yAxis.tickLine.display)return;t.lineWidth=1,t.strokeStyle=this.yAxis.axisLine.color||this.yAxis.color;let i,a,e=2*this.yAxis.tickText.size;this.yAxis.yAxisPosition===u.LEFT?(i=this.viewPortHandler.contentLeft(),a=this.yAxis.tickText.position===x.OUTSIDE?i-2*this.yAxis.tickLine.size:i+2*this.yAxis.tickLine.size):(i=this.viewPortHandler.contentRight(),a=this.yAxis.tickText.position===x.OUTSIDE?i+2*this.yAxis.tickLine.size:i-2*this.yAxis.tickLine.size);for(let s=0;s<this.values.length;s++){let o=this.getValueY(this.values[s]);this.checkShowLabel(o,e)&&(t.beginPath(),t.moveTo(i,o+.5),t.lineTo(a,o+.5),t.stroke(),t.closePath())}}checkShowLabel(t,i){return t>this.chartTop+i&&t<this.chartTop+this.chartHeight-i}getYAxisDataMinMax(t,i=!1,a=!1){let e=this.dataBounds.dataList,s=this.dataBounds.min,o=Math.min(s+this.dataBounds.range,e.length),r=[Number.MAX_VALUE,Number.MIN_VALUE];if(a)for(let n=s;n<o;n++){let t=e[n];r[0]=Math.min(t.averagePrice,r[0]),r[0]=Math.min(t.close,r[0]),r[1]=Math.max(t.averagePrice,r[1]),r[1]=Math.max(t.close,r[1])}else for(let n=s;n<o;n++){let a=e[n];this.calcIndexMinMax(a,t,r),i&&(r[0]=Math.min(a.low,r[0]),r[1]=Math.max(a.high,r[1]))}r[0]!==Number.MAX_VALUE&&r[1]!==Number.MIN_VALUE&&(this.axisMinimum=r[0],this.axisMaximum=r[1],this.computeAxis())}calcIndexMinMax(t,i,a){switch(i){case l.MA:a[0]=Math.min(t.ma.ma5,a[0]),a[0]=Math.min(t.ma.ma10,a[0]),a[0]=Math.min(t.ma.ma20,a[0]),a[0]=Math.min(t.ma.ma60,a[0]),a[1]=Math.max(t.ma.ma5,a[1]),a[1]=Math.max(t.ma.ma10,a[1]),a[1]=Math.max(t.ma.ma20,a[1]),a[1]=Math.max(t.ma.ma60,a[1]);break;case l.MACD:a[0]=Math.min(t.macd.dea,a[0]),a[0]=Math.min(t.macd.diff,a[0]),a[0]=Math.min(t.macd.macd,a[0]),a[1]=Math.max(t.macd.dea,a[1]),a[1]=Math.max(t.macd.diff,a[1]),a[1]=Math.max(t.macd.macd,a[1]);break;case l.VOL:a[0]=Math.min(t.vol.ma5,0),a[0]=Math.min(t.vol.ma10,0),a[0]=Math.min(t.vol.ma20,0),a[0]=Math.min(t.vol.num,0),a[1]=Math.max(t.vol.ma5,a[1]),a[1]=Math.max(t.vol.ma10,a[1]),a[1]=Math.max(t.vol.ma20,a[1]),a[1]=Math.max(t.vol.num,a[1]);break;case l.BOLL:a[0]=Math.min(t.boll.up,a[0]),a[0]=Math.min(t.boll.mid,a[0]),a[0]=Math.min(t.boll.dn,a[0]),a[0]=Math.min(t.low,a[0]),a[1]=Math.max(t.boll.up,a[1]),a[1]=Math.max(t.boll.mid,a[1]),a[1]=Math.max(t.boll.dn,a[1]),a[1]=Math.max(t.high,a[1]);break;case l.BIAS:a[0]=Math.min(t.bias.bias1,a[0]),a[0]=Math.min(t.bias.bias2,a[0]),a[0]=Math.min(t.bias.bias3,a[0]),a[1]=Math.max(t.bias.bias1,a[1]),a[1]=Math.max(t.bias.bias2,a[1]),a[1]=Math.max(t.bias.bias3,a[1]);break;case l.BRAR:a[0]=Math.min(t.brar.br,a[0]),a[0]=Math.min(t.brar.ar,a[0]),a[1]=Math.max(t.brar.br,a[1]),a[1]=Math.max(t.brar.ar,a[1]);break;case l.CCI:a[0]=Math.min(t.cci.cci,a[0]),a[1]=Math.max(t.cci.cci,a[1]);break;case l.CR:a[0]=Math.min(t.cr.cr,a[0]),a[0]=Math.min(t.cr.ma1,a[0]),a[0]=Math.min(t.cr.ma2,a[0]),a[0]=Math.min(t.cr.ma3,a[0]),a[0]=Math.min(t.cr.ma4,a[0]),a[1]=Math.max(t.cr.cr,a[1]),a[1]=Math.max(t.cr.ma1,a[1]),a[1]=Math.max(t.cr.ma2,a[1]),a[1]=Math.max(t.cr.ma3,a[1]),a[1]=Math.max(t.cr.ma4,a[1]);break;case l.DMA:a[0]=Math.min(t.dma.dif,a[0]),a[0]=Math.min(t.dma.difMa,a[0]),a[1]=Math.max(t.dma.dif,a[1]),a[1]=Math.max(t.dma.difMa,a[1]);break;case l.DMI:a[0]=Math.min(t.dmi.pdi,a[0]),a[0]=Math.min(t.dmi.mdi,a[0]),a[0]=Math.min(t.dmi.adx,a[0]),a[0]=Math.min(t.dmi.adxr,a[0]),a[1]=Math.max(t.dmi.pdi,a[1]),a[1]=Math.max(t.dmi.mdi,a[1]),a[1]=Math.max(t.dmi.adx,a[1]),a[1]=Math.max(t.dmi.adxr,a[1]);break;case l.KDJ:a[0]=Math.min(t.kdj.k,a[0]),a[0]=Math.min(t.kdj.d,a[0]),a[0]=Math.min(t.kdj.j,a[0]),a[1]=Math.max(t.kdj.k,a[1]),a[1]=Math.max(t.kdj.d,a[1]),a[1]=Math.max(t.kdj.j,a[1]);break;case l.KD:a[0]=Math.min(t.kdj.k,a[0]),a[0]=Math.min(t.kdj.d,a[0]),a[1]=Math.max(t.kdj.k,a[1]),a[1]=Math.max(t.kdj.d,a[1]);break;case l.RSI:a[0]=Math.min(t.rsi.rsi1,a[0]),a[0]=Math.min(t.rsi.rsi2,a[0]),a[0]=Math.min(t.rsi.rsi3,a[0]),a[1]=Math.max(t.rsi.rsi1,a[1]),a[1]=Math.max(t.rsi.rsi2,a[1]),a[1]=Math.max(t.rsi.rsi3,a[1]);break;case l.PSY:a[0]=Math.min(t.psy.psy,a[0]),a[1]=Math.max(t.psy.psy,a[1]);break;case l.TRIX:a[0]=Math.min(t.trix.trix,a[0]),a[0]=Math.min(t.trix.maTrix,a[0]),a[1]=Math.max(t.trix.trix,a[1]),a[1]=Math.max(t.trix.maTrix,a[1]);break;case l.OBV:a[0]=Math.min(t.obv.obv,a[0]),a[0]=Math.min(t.obv.maObv,a[0]),a[1]=Math.max(t.obv.obv,a[1]),a[1]=Math.max(t.obv.maObv,a[1]);break;case l.VR:a[0]=Math.min(t.vr.vr,a[0]),a[0]=Math.min(t.vr.maVr,a[0]),a[1]=Math.max(t.vr.vr,a[1]),a[1]=Math.max(t.vr.maVr,a[1]);break;case l.WR:a[0]=Math.min(t.wr.wr1,a[0]),a[0]=Math.min(t.wr.wr2,a[0]),a[0]=Math.min(t.wr.wr3,a[0]),a[1]=Math.max(t.wr.wr1,a[1]),a[1]=Math.max(t.wr.wr2,a[1]),a[1]=Math.max(t.wr.wr3,a[1]);break;case l.MTM:a[0]=Math.min(t.mtm.mtm,a[0]),a[0]=Math.min(t.mtm.mtmMa,a[0]),a[1]=Math.max(t.mtm.mtm,a[1]),a[1]=Math.max(t.mtm.mtmMa,a[1]);break;case l.EMV:a[0]=Math.min(t.emv.emv,a[0]),a[0]=Math.min(t.emv.maEmv,a[0]),a[1]=Math.max(t.emv.emv,a[1]),a[1]=Math.max(t.emv.maEmv,a[1]);break;case l.SAR:a[0]=Math.min(t.sar.sar,a[0]),a[1]=Math.max(t.sar.sar,a[1]),a[0]=Math.min(t.low,a[0]),a[1]=Math.max(t.high,a[1])}return a}computeAxis(){let t=this.axisMinimum,i=this.axisMaximum,a=Math.abs(i-t);0===a&&(i+=1,t-=1,a=Math.abs(i-t)),this.axisMinimum=t-a/100*10,this.axisMaximum=i+a/100*20,this.axisRange=Math.abs(this.axisMaximum-this.axisMinimum),this.computeAxisValues(this.axisMinimum,this.axisMaximum)}getValueY(t){return this.getY(t,this.axisMinimum,this.axisRange)}};var p=class extends o{constructor(t,i,a,e,s,o=l.MACD){super(e,s),this.indicator=t,this.xAxis=i,this.yAxisChart=new v(a,e,s),this.indicatorType=o}setChartDimens(t,i){super.setChartDimens(t,i),this.yAxisChart.setChartDimens(t,i)}draw(t){this.isDisplayChart()&&(this.drawChartHorizontalSeparatorLine(t),this.yAxisChart.getYAxisDataMinMax(this.indicatorType),this.yAxisChart.drawSeparatorLines(t),this.yAxisChart.drawTickLines(t),this.drawIndicator(t),this.yAxisChart.drawAxisLine(t),this.yAxisChart.drawAxisLabels(t))}drawChartHorizontalSeparatorLine(t){t.strokeStyle=this.xAxis.axisLine.color||this.xAxis.color,t.lineWidth=this.xAxis.axisLine.size,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.chartTop+.5),t.lineTo(this.viewPortHandler.contentRight(),this.chartTop+.5),t.stroke(),t.closePath()}drawIndicator(t,i=!1){switch(this.indicatorType){case l.MA:this.drawLines(t,"ma",["ma5","ma10","ma20","ma60"]);break;case l.MACD:this.drawBarLines(t,"macd","macd",["diff","dea"],(i,a,e)=>{let s=(i.macd||{}).macd,o=((a||{}).macd||{}).macd;s>0?(t.strokeStyle=this.indicator.increasingColor,t.fillStyle=this.indicator.increasingColor):(t.strokeStyle=this.indicator.decreasingColor,t.fillStyle=this.indicator.decreasingColor),(o||0===o)&&s>o?t.strokeRect(e[0],e[1],e[2]-e[0],e[3]-e[1]):t.fillRect(e[0],e[1],e[2]-e[0],e[3]-e[1])});break;case l.VOL:this.drawBarLines(t,"vol","num",["ma5","ma10","ma20"],(i,a,e)=>{let s=i.close,o=(a||{}).close;t.fillStyle=(o||0===o)&&s>o?this.indicator.increasingColor:this.indicator.decreasingColor,t.fillRect(e[0],e[1],e[2]-e[0],e[3]-e[1])});break;case l.BOLL:this.drawLines(t,"boll",["up","mid","dn"],(a,e)=>{let s=this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate)/2;this.drawOhlc(t,s,a,e,i)});break;case l.BIAS:this.drawLines(t,"bias",["bias1","bias2","bias3"]);break;case l.BRAR:this.drawLines(t,"brar",["br","ar"]);break;case l.CCI:this.drawLines(t,"cci",["cci"]);break;case l.CR:this.drawLines(t,"cr",["cr","ma1","ma2","ma3","ma4"]);break;case l.DMA:this.drawLines(t,"dma",["dif","difMa"]);break;case l.DMI:this.drawLines(t,"dmi",["mdi","pdi","adx","adxr"]);break;case l.KDJ:this.drawLines(t,"kdj",["k","d","j"]);break;case l.KD:this.drawLines(t,"kdj",["k","d"]);break;case l.RSI:this.drawLines(t,"rsi",["rsi1","rsi2","rsi3"]);break;case l.PSY:this.drawLines(t,"psy",["psy"]);break;case l.TRIX:this.drawLines(t,"trix",["trix","maTrix"]);break;case l.OBV:this.drawLines(t,"obv",["obv","maObv"]);break;case l.VR:this.drawLines(t,"vr",["vr","maVr"]);break;case l.WR:this.drawLines(t,"wr",["wr1","wr2","wr3"]);break;case l.MTM:this.drawLines(t,"mtm",["mtm","mtmMa"]);break;case l.EMV:this.drawLines(t,"emv",["emv","maEmv"]);break;case l.SAR:this.drawSar(t,i)}}drawSar(t,i){t.save(),t.beginPath(),t.rect(this.viewPortHandler.contentLeft(),this.chartTop,this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()-this.chartTop),t.closePath(),t.clip(),t.lineWidth=1;let a=this.viewPortHandler.contentLeft(),e=this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate),s=e/2,o=this.dataBounds.min;for(;o<this.dataBounds.dataList.length&&o<this.dataBounds.min+this.dataBounds.range;){let r=(a+(a+e))/2,n=this.dataBounds.dataList[o];this.drawOhlc(t,s,r,n,i);let h=n.sar.sar;if(h||0===h){let i=this.getValueY(h);h<(n.high+n.low)/2?t.strokeStyle=this.indicator.increasingColor:t.strokeStyle=this.indicator.decreasingColor,t.beginPath(),t.arc(r,i,s,2*Math.PI,0,!0),t.stroke(),t.closePath()}a+=this.dataBounds.dataSpace,++o}t.restore()}drawBarLines(t,i,a,e,s){let o=this.viewPortHandler.contentLeft(),r=this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate),n=r/2,h=this.dataBounds.min,l=[],d=[];for(;h<this.dataBounds.dataList.length&&h<this.dataBounds.min+this.dataBounds.range;){let t,c=(o+(o+r))/2,m=this.dataBounds.dataList[h];h>0&&(t=this.dataBounds.dataList[h-1]);let u=m[i],x=u[a];if(x||0===x){l[0]=c-n,l[2]=c+n;let i=this.getValueY(x),a=this.getValueY(0);l[1]=i,l[3]=a,s(m,t,l)}for(let i=0;i<e.length;i++){let t=u[e[i]],a=this.getValueY(t);d[i]?d[i].push({x:c,y:a}):d[i]=[{x:c,y:a}]}o+=this.dataBounds.dataSpace,++h}this.drawLine(t,d)}drawLines(t,i,a,e){let s=this.viewPortHandler.contentLeft(),o=this.dataBounds.min,r=this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate),n=[];for(;o<this.dataBounds.dataList.length&&o<this.dataBounds.min+this.dataBounds.range;){let t=(s+(s+r))/2,h=this.dataBounds.dataList[o];e&&e(t,h);let l=h[i];for(let i=0;i<a.length;i++){let e=l[a[i]],s=this.getValueY(e);n[i]?n[i].push({x:t,y:s}):n[i]=[{x:t,y:s}]}s+=this.dataBounds.dataSpace,++o}this.drawLine(t,n)}drawLine(t,i){for(let a=0;a<i.length;a++){let e=i[a];if(e.length>0){t.strokeStyle=this.indicator.lineColors[a],t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke(),t.closePath()}}}drawOhlc(t,i,a,e,s){if(!s){let s=this.getValueY(e.open),o=this.getValueY(e.close),r=this.getValueY(e.high),n=this.getValueY(e.low);e.close>e.open?t.strokeStyle=this.indicator.increasingColor:t.strokeStyle=this.indicator.decreasingColor,this.drawOhlcLines(t,i,a,s,o,r,n)}}drawOhlcLines(t,i,a,e,s,o,r){t.beginPath(),t.moveTo(a,o),t.lineTo(a,r),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(a-i,e+.5),t.lineTo(a,e+.5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(a+i,s+.5),t.lineTo(a,s+.5),t.stroke(),t.closePath()}getValueY(t){return this.getY(t,this.yAxisChart.axisMinimum,this.yAxisChart.axisRange)}isDisplayChart(){return this.indicatorType!==l.NO}};const k={SOLID:"solid",STROKE:"stroke",INCREASING_STROKE:"increasing_stroke",DECREASING_STROKE:"decreasing_stroke",OHLC:"ohlc"},y={CANDLE:"candle",TIME_LINE:"time_line"};var L=class{constructor(){this.chartStyle=y.CANDLE,this.timeChart={timeLineSize:1,timeLineColor:"#D8D8D8",timeLineFillColor:"#f4f4f4",timeAverageLineColor:"#F5A623"},this.candleChart={candleStyle:k.SOLID,increasingColor:"#5DB300",decreasingColor:"#FF4A4A"},this.lowestHighestPriceMarkTextColor="#898989",this.lowestHighestPriceMarkTextSize=10,this.lowestHighestValueFormatter=null,this.highestPriceMark={display:!0,color:"#898989",textSize:10,valueFormatter:null},this.lowestPriceMark={display:!0,color:"#898989",textSize:10,valueFormatter:null},this.lastPriceMark={display:!0,lineStyle:c.DASH,dashValue:[8,8],lineSize:1,lineColor:"#B9B9B9"}}};var w=class extends p{constructor(t,i,a,e,s){super(i,null,a,e,s),this.candle=t,this.indicatorType=l.MA,this.highestMarkData={},this.lowestMarkData={}}draw(t){let i=this.candle.chartStyle===y.TIME_LINE;this.yAxisChart.getYAxisDataMinMax(this.indicatorType,!0,i),this.yAxisChart.drawSeparatorLines(t),this.yAxisChart.drawTickLines(t),i?this.drawTimeLine(t):(this.drawCandle(t),this.drawIndicator(t,!0),this.drawHighestPriceMark(t),this.drawLowestPriceMark(t)),this.drawLastPriceMark(t),this.yAxisChart.drawAxisLine(t),this.yAxisChart.drawAxisLabels(t)}drawCandle(t){t.lineWidth=1;let i=this.dataBounds.dataList,a=this.viewPortHandler.contentLeft(),e=this.dataBounds.min,s=this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate),o=s/2,r=[],n=Number.MIN_VALUE,h=-1,l=Number.MAX_VALUE,d=-1;for(;e<i.length&&e<this.dataBounds.min+this.dataBounds.range;){let c=a+s,m=(a+c)/2,u=i[e],x=u.high,g=u.low;n<x&&(n=x,h=m),g<l&&(l=g,d=m);let v=this.getValueY(u.open),p=this.getValueY(u.close),y=this.getValueY(x),L=this.getValueY(g);if(u.close>u.open?(t.strokeStyle=this.candle.candleChart.increasingColor,t.fillStyle=this.candle.candleChart.increasingColor):(t.strokeStyle=this.candle.candleChart.decreasingColor,t.fillStyle=this.candle.candleChart.decreasingColor),this.candle.candleChart.candleStyle!==k.OHLC){let i=[],e=[];switch(v>p?(i[0]=y,i[1]=p,e[0]=v,e[1]=L,r=[a,p,c-a,v-p]):v<p?(i[0]=y,i[1]=v,e[0]=p,e[1]=L,r=[a,v,c-a,p-v]):(i[0]=y,i[1]=v,e[0]=p,e[1]=L,r=[a,v,c-a,1]),t.beginPath(),t.moveTo(m,i[0]),t.lineTo(m,i[1]),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(m,e[0]),t.lineTo(m,e[1]),t.stroke(),t.closePath(),this.candle.candleChart.candleStyle){case k.SOLID:t.fillRect(r[0],r[1],r[2],r[3]);break;case k.STROKE:t.strokeRect(r[0],r[1],r[2],r[3]);break;case k.INCREASING_STROKE:u.close>u.open?t.strokeRect(r[0],r[1],r[2],r[3]):t.fillRect(r[0],r[1],r[2],r[3]);break;case k.DECREASING_STROKE:u.close>u.open?t.fillRect(r[0],r[1],r[2],r[3]):t.strokeRect(r[0],r[1],r[2],r[3])}}else this.drawOhlcLines(t,o,m,v,p,y,L);a+=this.dataBounds.dataSpace,++e}this.highestMarkData={x:h,price:n},this.lowestMarkData={x:d,price:l}}drawHighestPriceMark(t){let i=this.highestMarkData.price;if(i===Number.MIN_VALUE||!this.candle.highestPriceMark.display)return;let a=this.candle.highestPriceMark.color||this.candle.lowestHighestPriceMarkTextColor,e=this.candle.highestPriceMark.textSize||this.candle.lowestHighestPriceMarkTextSize,s=this.candle.highestPriceMark.valueFormatter||this.candle.lowestHighestValueFormatter;this.drawLowestHighestPriceMark(t,this.highestMarkData.x,i,a,e,s,!0)}drawLowestPriceMark(t){let i=this.lowestMarkData.price;if(i===Number.MAX_VALUE||!this.candle.lowestPriceMark.display)return;let a=this.candle.lowestPriceMark.color||this.candle.lowestHighestPriceMarkTextColor,e=this.candle.lowestPriceMark.textSize||this.candle.lowestHighestPriceMarkTextSize,s=this.candle.lowestPriceMark.valueFormatter||this.candle.lowestHighestValueFormatter;this.drawLowestHighestPriceMark(t,this.lowestMarkData.x,i,a,e,s)}drawLowestHighestPriceMark(t,i,a,e,s,o,r=!1){t.save(),t.beginPath(),t.rect(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentTop(),this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft(),this.chartTop+this.chartHeight),t.closePath(),t.clip();let n=i,h=this.getValueY(a)+(r?-4:4)+.5;t.textAlign="left",t.lineWidth=1,t.strokeStyle=e,t.fillStyle=e,t.beginPath(),t.moveTo(n+.5,h+.5),t.lineTo(n-4+.5,h+(r?-4:4)+.5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(n+.5,h+.5),t.lineTo(n+4+.5,h+(r?-4:4)+.5),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(n+.5,h),h+=r?-10:10,t.lineTo(n+.5,h),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(n,h+.5),t.lineTo(n+10,h+.5),t.stroke(),t.closePath(),t.font=2*s+"px Arial";let l=a.toFixed(2);o&&(l=o(a)+""),t.textBaseline="middle",t.fillText(l,n+14,h),t.restore()}drawLastPriceMark(t){if(!this.candle.lastPriceMark.display||0===this.dataBounds.dataList.length)return;let i=this.dataBounds.dataList[this.dataBounds.dataList.length-1].close,a=this.getValueY(i);a=+Math.max(this.chartTop+.05*this.chartHeight,Math.min(a,this.chartTop+.98*this.chartHeight)).toFixed(0),t.strokeStyle=this.candle.lastPriceMark.lineColor,t.lineWidth=this.candle.lastPriceMark.lineSize,this.candle.lastPriceMark.lineStyle===c.DASH&&t.setLineDash(this.candle.lastPriceMark.dashValue),t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),a+.5),t.lineTo(this.viewPortHandler.contentRight(),a+.5),t.stroke(),t.closePath(),t.setLineDash([])}drawTimeLine(t){let i=[],a=[{x:this.viewPortHandler.contentLeft(),y:this.chartTop+this.chartHeight}],e=[];t.lineWidth=this.candle.timeChart.timeLineSize;let s=this.dataBounds.dataList,o=this.viewPortHandler.contentLeft(),r=this.dataBounds.min,n=this.dataBounds.dataSpace-this.dataBounds.dataMarginSpaceRate*this.dataBounds.dataSpace;for(;r<this.dataBounds.dataList.length&&r<this.dataBounds.min+this.dataBounds.range;){let t=+((o+(o+n))/2).toFixed(0),h=s[r],l=this.getValueY(h.close),d=this.getValueY(h.averagePrice);i.push({x:t,y:l}),h.averagePrice&&e.push({x:t,y:d}),r===this.dataBounds.min?(a.push({x:this.viewPortHandler.contentLeft(),y:l}),a.push({x:t,y:l})):r===this.dataBounds.min+this.dataBounds.range-1?(a.push({x:t,y:l}),a.push({x:this.viewPortHandler.contentRight(),y:l}),a.push({x:this.viewPortHandler.contentRight(),y:this.chartHeight+this.chartTop})):r===this.dataBounds.dataList.length-1?(a.push({x:t,y:l}),a.push({x:t,y:this.chartTop+this.chartHeight})):a.push({x:t,y:l}),o+=this.dataBounds.dataSpace,++r}if(i.length>0){t.strokeStyle=this.candle.timeChart.timeLineColor,t.beginPath(),t.moveTo(i[0].x,i[0].y);for(let a=1;a<i.length;a++)t.lineTo(i[a].x,i[a].y);t.stroke(),t.closePath()}if(a.length>0){t.fillStyle=this.candle.timeChart.timeLineFillColor,t.beginPath(),t.moveTo(a[0].x,a[0].y);for(let i=1;i<a.length;i++)t.lineTo(a[i].x,a[i].y);t.closePath(),t.fill()}if(e.length>0){t.strokeStyle=this.candle.timeChart.timeAverageLineColor,t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.stroke(),t.closePath()}}};var M=class extends h{constructor(t,i,a){super(i,a),this.xAxis=t}draw(t){this.computeAxis(),this.drawAxisLine(t),this.drawTickLines(t),this.drawAxisLabels(t),this.drawSeparatorLines(t)}drawAxisLine(t){this.xAxis.display&&this.xAxis.axisLine.display&&(t.strokeStyle=this.xAxis.axisLine.color||this.xAxis.color,t.lineWidth=this.xAxis.axisLine.size,t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.viewPortHandler.contentBottom()+.5),t.lineTo(this.viewPortHandler.contentRight(),this.viewPortHandler.contentBottom()+.5),t.stroke(),t.closePath())}drawAxisLabels(t){if(!this.xAxis.display||!this.xAxis.tickText.display)return;t.textBaseline="top",t.font=2*this.xAxis.tickText.size+"px Arial",t.textAlign="center",t.fillStyle=this.xAxis.tickText.color||this.xAxis.color;let i=this.pointValuesToPixel(),a=this.viewPortHandler.contentBottom()+2*this.xAxis.tickText.margin;this.display&&this.xAxis.tickLine.display&&(a+=2*this.xAxis.tickLine.size);let e=this.xAxis.tickText.valueFormatter;for(let s=0;s<i.length;s+=2){let o=i[s];if(this.viewPortHandler.isInBoundsX(o)){let i=this.dataBounds.dataList[parseInt(this.values[s/2])],r=i.timestamp,h=n.formatDate(r);e&&(h=e(i)),t.fillText(h,o,a)}}}drawSeparatorLines(t){if(!this.xAxis.display||!this.xAxis.separatorLine.display)return;t.strokeStyle=this.xAxis.separatorLine.color||this.xAxis.color,t.lineWidth=this.xAxis.separatorLine.size,this.xAxis.separatorLine.style===c.DASH&&t.setLineDash(this.xAxis.separatorLine.dashValue);let i=this.pointValuesToPixel();for(let a=0;a<i.length;a+=2){let e=i[a];this.viewPortHandler.isInBoundsX(e)&&(t.beginPath(),t.moveTo(e+.5,this.viewPortHandler.contentTop()),t.lineTo(e+.5,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath())}t.setLineDash([])}drawTickLines(t){if(!this.xAxis.display||!this.xAxis.tickLine.display)return;t.lineWidth=1,t.strokeStyle=this.xAxis.axisLine.color||this.xAxis.color;let i=this.pointValuesToPixel(),a=this.viewPortHandler.contentBottom(),e=a+2*this.xAxis.tickLine.size;for(let s=0;s<i.length;s+=2){let o=i[s];this.viewPortHandler.isInBoundsX(o)&&(t.beginPath(),t.moveTo(o+.5,a),t.lineTo(o+.5,e),t.stroke(),t.closePath())}}pointValuesToPixel(){let t=[];for(let i=0;i<2*this.valueCount;i+=2){let a=this.values[i/2];t[i]=parseInt((a-this.dataBounds.min)*this.dataBounds.dataSpace+this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate)/2)}return t}computeAxis(){let t=this.dataBounds.min,i=Math.min(t+this.dataBounds.range-1,this.dataBounds.dataList.length-1);this.computeAxisValues(t,i)}};const P={ALWAYS:"always",FOLLOW_CROSS:"follow_cross",NONE:"none"};var f=class{constructor(){this.textSize=12,this.crossLine={display:!0,style:c.SOLID,dashValue:[8,8],size:1,color:"#505050",text:{color:"#EDEDED",size:12,rectStrokeLineSize:1,rectStrokeLineColor:"#EDEDED",rectFillColor:"#505050",margin:4,valueFormatter:null}},this.generalData={labels:["\u65f6\u95f4","\u5f00","\u6536","\u9ad8","\u4f4e"],values:null,valueFormatter:null,text:{size:12,color:"#898989",margin:20}},this.indicatorData={displayRule:P.ALWAYS,valueFormatter:null,text:{size:12,margin:20}}}};var C=class extends o{constructor(t,i,a,e,s,o,r,n,h){super(n,h),this.displayCross=!1,this.crossPoint={x:0,y:0},this.tooltip=t,this.candle=i,this.indicator=a,this.yAxis=e,this.candleChart=s,this.volChart=o,this.indicatorChart=r,this.yAxisLabelStrokePathPoints=[]}draw(t){if(this.dataBounds.currentDataPos<this.dataBounds.dataList.length){let i=this.dataBounds.dataList[this.dataBounds.currentDataPos];if(this.displayCross&&(this.crossPoint.x=this.viewPortHandler.contentLeft()+this.dataBounds.dataSpace*(this.dataBounds.currentDataPos-this.dataBounds.min)+this.dataBounds.dataSpace*(1-this.dataBounds.dataMarginSpaceRate)/2,t.font=2*(this.tooltip.crossLine.text.size||this.tooltip.textSize)+"px Arial",this.tooltip.crossLine.display&&(this.drawCrossHorizontalLine(t),this.drawCrossVerticalLine(t,i))),this.tooltip.indicatorData.displayRule===P.ALWAYS||this.tooltip.indicatorData.displayRule===P.FOLLOW_CROSS){let a=2*(this.tooltip.indicatorData.text.size||this.tooltip.textSize),e=this.viewPortHandler.contentLeft()+10;t.font=a+"px Arial",t.textBaseline="top",this.drawGeneralDataTooltip(t,e,i),this.candle.chartStyle!==y.TIME_LINE&&this.drawIndicatorTooltip(t,e,this.candleChart.chartTop+4+a+10,i,this.candleChart.indicatorType),this.drawIndicatorTooltip(t,e,this.volChart.chartTop+4,i,this.volChart.indicatorType),this.drawIndicatorTooltip(t,e,this.indicatorChart.chartTop+4,i,this.indicatorChart.indicatorType)}}}drawCrossHorizontalLine(t){let i=this.getCrossYAxisLabel();if(null==i)return;let a,e=this.yAxis.tickText.position===x.OUTSIDE,s=this.tooltip.crossLine.text.size||this.tooltip.textSize,o=n.calcTextWidth(2*s+"px Arial",i),r=s,h=this.crossPoint.y,l=this.viewPortHandler.contentLeft(),d=this.viewPortHandler.contentRight(),m=this.viewPortHandler.getContentCenter(),g=this.tooltip.crossLine.text.margin,v=this.tooltip.crossLine.text.rectStrokeLineSize;e?a=this.yAxis.yAxisPosition===u.LEFT?l-v-2*g-o:d+v+2*g:this.crossPoint.x>m.x?(l=this.viewPortHandler.contentLeft()+2*v+3*g+o,a=this.viewPortHandler.contentLeft()+v+g):a=(d=this.viewPortHandler.contentRight()-2*v-3*g-o)+v+2*g,!e&&this.crossPoint.x>m.x||e&&this.yAxis.yAxisPosition===u.LEFT?(this.yAxisLabelStrokePathPoints[0]={x:l,y:this.crossPoint.y},this.yAxisLabelStrokePathPoints[1]={x:l-g,y:this.crossPoint.y-r-g},this.yAxisLabelStrokePathPoints[2]={x:l-3*g-o,y:this.yAxisLabelStrokePathPoints[1].y},this.yAxisLabelStrokePathPoints[3]={x:this.yAxisLabelStrokePathPoints[2].x,y:this.crossPoint.y+r+g},this.yAxisLabelStrokePathPoints[4]={x:this.yAxisLabelStrokePathPoints[1].x,y:this.yAxisLabelStrokePathPoints[3].y}):(this.yAxisLabelStrokePathPoints[0]={x:d,y:this.crossPoint.y},this.yAxisLabelStrokePathPoints[1]={x:d+g,y:this.crossPoint.y-r-g},this.yAxisLabelStrokePathPoints[2]={x:d+3*g+o,y:this.yAxisLabelStrokePathPoints[1].y},this.yAxisLabelStrokePathPoints[3]={x:this.yAxisLabelStrokePathPoints[2].x,y:this.crossPoint.y+r+g},this.yAxisLabelStrokePathPoints[4]={x:this.yAxisLabelStrokePathPoints[1].x,y:this.yAxisLabelStrokePathPoints[3].y}),t.lineWidth=this.tooltip.crossLine.size,t.strokeStyle=this.tooltip.crossLine.color,this.tooltip.crossLine.style===c.DASH&&t.setLineDash(this.tooltip.crossLine.dashValue),t.beginPath(),t.moveTo(l,this.crossPoint.y+.5),t.lineTo(d,this.crossPoint.y+.5),t.stroke(),t.closePath(),t.setLineDash([]),t.fillStyle=this.tooltip.crossLine.text.rectFillColor,t.beginPath(),t.moveTo(this.yAxisLabelStrokePathPoints[0].x,this.yAxisLabelStrokePathPoints[0].y);for(let n=1;n<this.yAxisLabelStrokePathPoints.length;n++)t.lineTo(this.yAxisLabelStrokePathPoints[n].x,this.yAxisLabelStrokePathPoints[n].y);t.closePath(),t.fill(),t.lineWidth=this.tooltip.crossLine.text.rectStrokeLineSize,t.strokeStyle=this.tooltip.crossLine.text.rectStrokeLineColor,t.beginPath(),t.moveTo(this.yAxisLabelStrokePathPoints[0].x,this.yAxisLabelStrokePathPoints[0].y);for(let n=1;n<this.yAxisLabelStrokePathPoints.length;n++)t.lineTo(this.yAxisLabelStrokePathPoints[n].x,this.yAxisLabelStrokePathPoints[n].y);t.closePath(),t.stroke(),t.textBaseline="middle",t.fillStyle=this.tooltip.crossLine.text.color,t.fillText(i,a,h)}getCrossYAxisLabel(){let t=this.candleChart.yAxisChart,i=t.chartHeight,a=t.chartTop,e=this.volChart.yAxisChart,s=e.chartHeight,o=e.chartTop,r=this.indicatorChart.yAxisChart,n=r.chartHeight,h=r.chartTop,d=this.crossPoint.y;if(d>a&&d<i+a){let e=t.axisMinimum,s=(1-(d-a)/i)*(t.axisMaximum-e)+e,o=s.toFixed(2);return this.tooltip.crossLine.text.valueFormatter&&(o=this.tooltip.crossLine.text.valueFormatter("y",s)||"--"),o}if(d>o&&d<o+s){let t=e.axisMinimum,i=(1-(d-o)/s)*(e.axisMaximum-t)+t,a=i.toFixed(0);return this.tooltip.crossLine.text.valueFormatter&&(a=this.tooltip.crossLine.text.valueFormatter("y",i)||"--"),a}if(d>h&&d<h+n){let t=r.axisMinimum,i=(1-(d-h)/n)*(r.axisMaximum-t)+t,a=i.toFixed(2);return this.indicatorChart.indicatorType===l.VOL&&(a=i.toFixed(0)),this.tooltip.crossLine.text.valueFormatter&&(a=this.tooltip.crossLine.text.valueFormatter("y",i)||"--"),a}return null}drawCrossVerticalLine(t,i){t.lineWidth=this.tooltip.crossLine.size,t.strokeStyle=this.tooltip.crossLine.color,this.tooltip.crossLine.style===c.DASH&&t.setLineDash(this.tooltip.crossLine.dashValue),t.beginPath(),t.moveTo(this.crossPoint.x+.5,this.viewPortHandler.contentTop()),t.lineTo(this.crossPoint.x+.5,this.viewPortHandler.contentBottom()),t.stroke(),t.closePath(),t.setLineDash([]);let a=i.timestamp,e=n.formatDate(a);this.tooltip.crossLine.text.valueFormatter&&(e=this.tooltip.crossLine.text.valueFormatter("x",i)||"--");let s=this.tooltip.crossLine.text.size||this.tooltip.textSize,o=n.calcTextWidth(2*s+"px Arial",e),r=this.crossPoint.x-o/2,h=this.tooltip.crossLine.text.margin,l=this.tooltip.crossLine.text.rectStrokeLineSize;r<this.viewPortHandler.contentLeft()+h+l?r=this.viewPortHandler.contentLeft():r>this.viewPortHandler.contentRight()-o-l&&(r=this.viewPortHandler.contentRight()-o-l);let d=r-l-h,m=this.viewPortHandler.contentBottom(),u=r+o+h+l,x=this.viewPortHandler.contentBottom()+2*s+l+2*h;t.fillStyle=this.tooltip.crossLine.text.rectFillColor,t.fillRect(d,m,u-d,x-m),t.lineWidth=l,t.strokeStyle=this.tooltip.crossLine.text.rectStrokeLineColor,t.strokeRect(d,m,u-d,x-m),t.textBaseline="top",t.fillStyle=this.tooltip.crossLine.text.color,t.fillText(e,r,this.viewPortHandler.contentBottom()+l+h)}drawGeneralDataTooltip(t,i,a){let e=this.tooltip.generalData.text.size||this.tooltip.textSize;t.font=2*e+"px Arial";let s=this.tooltip.generalData.text.color,o=[];if(this.tooltip.generalData.values)o=this.tooltip.generalData.values(a)||[];else{let t=this.tooltip.generalData.valueFormatter,i=n.formatDate(a.timestamp),e=a.open.toFixed(2),s=a.close.toFixed(2),r=a.high.toFixed(2),h=a.low.toFixed(2);t&&(i=t(0,a.timestamp)||"--",e=t(1,a.open)||"--",s=t(2,a.close)||"--",r=t(3,a.high)||"--",h=t(4,a.low)||"--"),o=[i,e,s,r,h]}let r=this.tooltip.generalData.labels;for(let h=0;h<r.length;h++){let a=(r[h]||"--")+": ",l=n.calcTextWidth(2*e+"px Arial",a);t.fillStyle=s,t.fillText(a,i,4),i+=l;let d,c=o[h]||"--";"object"===typeof c?(d=c.value||"--",t.fillStyle=c.color||s):(t.fillStyle=s,d=c);let m=n.calcTextWidth(2*e+"px Arial",d);t.fillText(d,i,4),i+=m+this.tooltip.generalData.text.margin}}drawIndicatorTooltip(t,i,a,e,s){switch(s){case l.MA:{let s=e.ma;this.drawIndicatorTooltipLabels(t,i,a,[s.ma5,s.ma10,s.ma20,s.ma60],["MA5","MA10","MA20","MA60"],e,l.MA);break}case l.MACD:{let s=e.macd;this.drawIndicatorTooltipLabels(t,i,a,[s.diff,s.dea,s.macd],["DIFF","DEA","MACD"],e,l.MACD);break}case l.VOL:{let s=e.vol;this.drawIndicatorTooltipLabels(t,i,a,[s.ma5,s.ma10,s.ma20,s.num],["MA5","MA10","MA20","VOLUME"],e,l.VOL);break}case l.BOLL:{let s=e.boll;this.drawIndicatorTooltipLabels(t,i,a,[s.up,s.mid,s.dn],["UP","MID","DN"],e,l.BOLL);break}case l.BIAS:{let s=e.bias;this.drawIndicatorTooltipLabels(t,i,a,[s.bias1,s.bias2,s.bias3],["BIAS6","BIAS12","BIAS24"],e,l.BIAS);break}case l.BRAR:{let s=e.brar;this.drawIndicatorTooltipLabels(t,i,a,[s.br,s.ar],["BR","AR"],e,l.BRAR);break}case l.CCI:{let s=e.cci;this.drawIndicatorTooltipLabels(t,i,a,[s.cci],["CCI"],e,l.CCI);break}case l.CR:{let s=e.cr;this.drawIndicatorTooltipLabels(t,i,a,[s.cr,s.ma1,s.ma2,s.ma3,s.ma4],["CR","MA1","MA2","MA3","MA4"],e,l.CR);break}case l.DMA:{let s=e.dma;this.drawIndicatorTooltipLabels(t,i,a,[s.dif,s.difMa],["DIF","DIFMA"],e,l.DMA);break}case l.DMI:{let s=e.dmi;this.drawIndicatorTooltipLabels(t,i,a,[s.mdi,s.pdi,s.adx,s.adxr],["MDI","PDI","ADX","ADXR"],e,l.DMI);break}case l.KDJ:{let s=e.kdj;this.drawIndicatorTooltipLabels(t,i,a,[s.k,s.d,s.j],["K","D","J"],e,l.KDJ);break}case l.KD:{let s=e.kdj;this.drawIndicatorTooltipLabels(t,i,a,[s.k,s.d],["K","D"],e,l.KDJ);break}case l.RSI:{let s=e.rsi;this.drawIndicatorTooltipLabels(t,i,a,[s.rsi1,s.rsi2,s.rsi3],["RSI6","RSI12","RSI24"],e,l.RSI);break}case l.PSY:{let s=e.psy;this.drawIndicatorTooltipLabels(t,i,a,[s.psy],["PSY"],e,l.PSY);break}case l.TRIX:{let s=e.trix;this.drawIndicatorTooltipLabels(t,i,a,[s.trix,s.maTrix],["TRIX","MATRIX"],e,l.TRIX);break}case l.OBV:{let s=e.obv;this.drawIndicatorTooltipLabels(t,i,a,[s.obv,s.maObv],["OBV","MAOBV"],e,l.OBV);break}case l.VR:{let s=e.vr;this.drawIndicatorTooltipLabels(t,i,a,[s.vr,s.maVr],["VR","MAVR"],e,l.VR);break}case l.WR:{let s=e.wr;this.drawIndicatorTooltipLabels(t,i,a,[s.wr1,s.wr2,s.wr3],["WR1","WR2","WR3"],e,l.WR);break}case l.MTM:{let s=e.mtm;this.drawIndicatorTooltipLabels(t,i,a,[s.mtm,s.mtmMa],["MTM","MTMMA"],e,l.MTM);break}case l.EMV:{let s=e.emv;this.drawIndicatorTooltipLabels(t,i,a,[s.emv,s.maEmv],["EMV","MAEMV"],e,l.EMV);break}case l.SAR:{let s=e.sar;this.drawIndicatorTooltipLabels(t,i,a,[s.sar],["SAR"],e,l.SAR);break}}}drawIndicatorTooltipLabels(t,i,a,e,s,o,r){let h=i;for(let d=0;d<e.length;d++){let i=e[d],o="--";(i||0===i)&&(o=r===l.VOL?i.toFixed(0):i.toFixed(2)),this.tooltip.indicatorData.valueFormatter&&(o=this.tooltip.indicatorData.valueFormatter(r,i)||"--");let c=s[d]+": "+o,m=n.calcTextWidth(2*(this.tooltip.indicatorData.text.size||this.tooltip.textSize)+"px Arial",c);t.fillStyle=this.indicator.lineColors[d],t.fillText(c,h,a),h+=this.tooltip.indicatorData.text.margin+m}}setCross(t,i){this.crossPoint.y=t,this.displayCross=i}};const D={NONE:"none",HORIZONTAL_LINE:"horizontal_line",VERTICAL_LINE:"vertical_line",LINE:"line",HORIZONTAL_SEGMENT:"horizontal_segment",VERTICAL_SEGMENT:"vertical_segment",SEGMENT:"segment",ARROW_LINE:"arrow_line"},A={LINE:"line",POINT:"point",NONE:"none"};var T=class{constructor(){this.markingType=D.NONE,this.startMarkPoint={x:0,y:0},this.markingDatas=[],this.horizontalLineDatas=[],this.verticalLineDatas=[],this.lineDatas=[],this.horizontalSegmentDatas=[],this.verticalSegmentDatas=[],this.segmentDatas=[],this.arrowLineDatas=[]}};var b=class extends o{constructor(t,i,a,e){super(a,e),this.mark=t,this.markData=i}draw(t){t.save(),t.beginPath(),t.rect(this.viewPortHandler.contentLeft(),this.chartTop,this.viewPortHandler.contentRight()-this.viewPortHandler.contentLeft(),this.chartHeight),t.closePath(),t.clip(),this.drawStartPoint(t),this.drawHorizontalVerticalLine(t,this.markData.horizontalLineDatas,D.HORIZONTAL_LINE),this.drawHorizontalVerticalLine(t,this.markData.verticalLineDatas,D.VERTICAL_LINE),this.drawLine(t)}drawPoint(t,i,a){let e=2*(a?this.mark.point.highlight.radius:this.mark.point.radius);t.fillStyle=a?this.mark.point.highlight.fillColor:this.mark.point.fillColor,t.strokeStyle=a?this.mark.point.highlight.strokeColor:this.mark.point.strokeColor,t.lineWidth=1,t.beginPath(),t.arc(i.x,i.y,e,0,2*Math.PI,!0),t.fill(),t.closePath(),t.beginPath(),t.arc(i.x,i.y,e,0,2*Math.PI,!0),t.stroke(),t.closePath()}drawStartPoint(t){if(this.markData.markingType!==D.NONE&&0===this.markData.markingDatas.length){let i=this.markData.startMarkPoint;this.drawPoint(t,i,!0)}}drawHorizontalVerticalLine(t,i,a){let e=i.length;for(let o=0;o<e;o++){let e=i[o];t.lineWidth=1,e.activeType!==A.LINE&&e.activeType!==A.POINT||(this.drawPoint(t,e,e.activeType===A.POINT),t.strokeStyle=this.mark.line.highlight.color),t.beginPath(),a===D.HORIZONTAL_LINE?(t.moveTo(this.viewPortHandler.contentLeft(),e.y),t.lineTo(this.viewPortHandler.contentRight(),e.y)):(t.moveTo(e.x,this.viewPortHandler.contentTop()),t.lineTo(e.x,this.viewPortHandler.contentBottom())),t.stroke(),t.closePath()}let s=this.markData.markingDatas[0];s&&this.markData.markingType===a&&(t.lineWidth=1,t.strokeStyle=this.mark.line.highlight.color,t.beginPath(),a===D.HORIZONTAL_LINE?(t.moveTo(this.viewPortHandler.contentLeft(),s.y),t.lineTo(this.viewPortHandler.contentRight(),s.y)):(t.moveTo(s.x,this.viewPortHandler.contentTop()),t.lineTo(s.x,this.viewPortHandler.contentBottom())),t.stroke(),t.closePath(),this.drawPoint(t,s,!0))}drawLine(t){let i=this.markData.lineDatas.length;t.lineWidth=1,t.strokeStyle="#ffffff";for(let e=0;e<i;e++){let i=this.markData.lineDatas[e].points;t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.getY(this.viewPortHandler.contentLeft(),i[0],i[1])),t.lineTo(this.viewPortHandler.contentRight(),this.getY(this.viewPortHandler.contentRight(),i[0],i[1])),t.stroke(),t.closePath()}let a=this.markData.markingDatas.length;a>0&&this.markData.markingType===D.LINE&&(1===a?this.drawPoint(t,this.markData.markingDatas[0],!0):(this.drawPoint(t,this.markData.markingDatas[0],!1),this.drawPoint(t,this.markData.markingDatas[1],!0),t.beginPath(),t.moveTo(this.viewPortHandler.contentLeft(),this.getY(this.viewPortHandler.contentLeft(),this.markData.markingDatas[0],this.markData.markingDatas[1])),t.lineTo(this.viewPortHandler.contentRight(),this.getY(this.viewPortHandler.contentRight(),this.markData.markingDatas[0],this.markData.markingDatas[1])),t.stroke(),t.closePath()))}getY(t,i,a){return(a.y-i.y)/(a.x-i.x)*t+i.y-(a.y-i.y)/(a.x-i.x)*i.x}};var S=class extends m{constructor(){super(),this.xAxisMaxHeight=20,this.xAxisMinHeight=20}getRequiredHeightSpace(){let t=2*this.tickText.size+2*this.tickText.margin;this.display&&this.tickLine.display&&(t+=2*this.tickLine.size),this.display&&this.axisLine.display&&(t+=this.axisLine.size);let i=t;return this.xAxisMaxHeight>0&&(i=2*this.xAxisMaxHeight),t=Math.max(2*this.xAxisMinHeight,Math.min(t,i)),parseInt(t)}};var B=class{constructor(){this.display=!0,this.lineSize=1,this.lineColor="#707070"}};var H=class{constructor(){this.line={color:"#DEDEDE",highlight:{color:"#ffffff"}},this.point={fillColor:"#DEDEDE",strokeColor:"#DEDEDE",radius:4,highlight:{fillColor:"#FFFFFF",strokeColor:"#FFFFFF",radius:5}}}};var R=class{constructor(t,i,a){this.kline=t,this.dataBounds=i,this.viewPortHandler=a}isValidEvent(t){return!(t.x<this.viewPortHandler.contentLeft()||t.x>this.viewPortHandler.contentRight()||t.y<this.viewPortHandler.contentTop()||t.y>this.viewPortHandler.contentBottom())}getCanvasPoint(t){let i=this.kline.markCanvasDom.getBoundingClientRect();return{x:2*Math.round(t.clientX-i.left),y:2*Math.round(t.clientY-i.top)}}stopEvent(t){t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0,t&&t.preventDefault?t.preventDefault():window.event.returnValue=!1}};const I="cross",E="drag";var V=class extends R{constructor(t,i,a){super(t,i,a),this.mouseMode=I,this.mouseDownPoint={x:0,y:0}}mouseDown(t){if(this.stopEvent(t),0===t.button){let i=this.getCanvasPoint(t);if(!this.isValidEvent(i))return;this.mouseMode=E,this.mouseDownPoint.x=t.x,this.mouseDownPoint.y=t.y,this.kline.tooltipChart.setCross(i.y,!1),this.kline.freshen(J)}}mouseUp(t){this.stopEvent(t);let i=this.getCanvasPoint(t);this.isValidEvent(i)&&(this.mouseMode=I,this.kline.tooltipChart.setCross(i.y,!0),this.kline.freshen(J))}mouseLeave(t){this.stopEvent(t);let i=this.getCanvasPoint(t);this.kline.tooltipChart.setCross(i.y,!1),this.kline.freshen(J)}mouseMove(t){this.stopEvent(t);let i=this.getCanvasPoint(t);if(!this.isValidEvent(i))return this.kline.tooltipChart.setCross(i.y,!1),void this.kline.freshen(J);if(this.mouseMode===E){let i=t.x-this.mouseDownPoint.x;if(i>this.dataBounds.dataSpace/2){if(0===this.dataBounds.min||this.dataBounds.dataList.length<this.dataBounds.range)return!1;this.mouseDownPoint.x=t.x;let a=+Math.abs(i/this.dataBounds.dataSpace).toFixed(0);0===a&&(a=1),this.dataBounds.min-=a,this.dataBounds.min<=0&&(this.dataBounds.min=0),this.kline.freshen(q)}else if(i<0-this.dataBounds.dataSpace/2){if(this.dataBounds.min+this.dataBounds.range===this.dataBounds.dataList.length||this.dataBounds.dataList.length<this.dataBounds.range)return!1;this.mouseDownPoint.x=t.x;let a=+Math.abs(i/this.dataBounds.dataSpace).toFixed(0);0===a&&(a=1),this.dataBounds.min+=a,this.dataBounds.min>=this.dataBounds.dataList.length-this.dataBounds.range&&(this.dataBounds.min=this.dataBounds.dataList.length-this.dataBounds.range),this.kline.freshen()}}else this.mouseMode===I&&(this.dataBounds.calcCurrentDataIndex(i.x),this.kline.tooltipChart.setCross(i.y,!0),this.kline.freshen(J))}mouseWheel(t){let i=this.getCanvasPoint(t);if(!this.isValidEvent(i))return;this.stopEvent(t);let a=this.dataBounds.min,e=this.dataBounds.range,s=1;if(1===Math.max(-1,Math.min(1,t.wheelDelta||-t.deltaY))){if(s=.95,this.dataBounds.range>=this.dataBounds.maxRange)return!1}else if(s=1.05,this.dataBounds.range<=this.dataBounds.minRange)return!1;this.dataBounds.range=+(e/s).toFixed(0),this.dataBounds.range=Math.min(Math.max(this.dataBounds.range,this.dataBounds.minRange),this.dataBounds.maxRange),this.dataBounds.min=a+e-this.dataBounds.range,this.dataBounds.min+this.dataBounds.range>this.dataBounds.dataList.length&&(this.dataBounds.min=0),this.dataBounds.min<0&&(this.dataBounds.min=0),this.kline.freshen(q)}};const O=0,z=1,N=2,F=3,W=4,_=5;var Y=class extends R{constructor(t,i,a){super(t,i,a),this.touchMode=O,this.touchStartPoint={x:0,y:0},this.touchMovePoint={x:0,y:0},this.touchCrossPoint={x:0,y:0},this.savedDist=1,this.savedXDist=1,this.touchRange=this.dataBounds.range,this.touchStartPosition=this.dataBounds.min,this.delayTimeout=null,this.delayActiveCross=(()=>{this.touchMode!==O&&this.touchMode!==_||this.kline&&(this.touchMode=W,this.touchCrossPoint={x:this.touchStartPoint.x,y:this.touchStartPoint.y},i.calcCurrentDataIndex(this.touchCrossPoint.x),this.kline.tooltipChart.setCross(this.touchCrossPoint.y,!0),this.kline.freshen(J))})}touchStart(t){if(1===t.targetTouches.length){let i=this.getCanvasPoint(t.targetTouches[0]);if(this.touchStartPoint={x:i.x,y:i.y},this.touchMovePoint={x:i.x,y:i.y},!this.isValidEvent(this.touchStartPoint))return;this.touchMode===W?(this.stopEvent(t),this.distance(i.x,this.touchCrossPoint.x,i.y,this.touchCrossPoint.y)<10?this.performCross(t):(this.touchMode=_,this.kline.tooltipChart.setCross(0,!1),this.kline.freshen(J))):this.touchMode=O,this.removeDelayActiveCross(),this.postDelayDelayActiveCross()}else if(t.targetTouches.length>1){if(!this.isValidEvent(this.touchStartPoint))return;this.touchMode!==W&&(this.stopEvent(t),this.savedDist=this.spacing(t),this.savedXDist=this.getXDist(t),this.savedDist>3&&(this.touchMode=N),this.touchRange=this.dataBounds.range,this.touchStartPosition=this.dataBounds.min)}}touchMove(t){if(this.isValidEvent(this.touchStartPoint))switch(this.touchMode){case N:this.stopEvent(t),this.performZoom(t);break;case z:this.stopEvent(t),this.performDrag(t);break;case W:this.stopEvent(t),this.performCross(t);break;case _:this.removeDelayActiveCross();break;case O:{let i=this.getCanvasPoint(t.targetTouches[0]);if(Math.abs(this.distance(i.x,this.touchStartPoint.x,i.y,this.touchStartPoint.y))>10){let a=Math.abs(i.x-this.touchStartPoint.x);Math.abs(i.y-this.touchStartPoint.y)<=a&&(this.stopEvent(t),this.kline.tooltipChart.setCross(0,!1),this.touchMode=z,this.kline.freshen(J))}this.removeDelayActiveCross()}}}touchEnd(t){this.isValidEvent(this.touchStartPoint)&&(this.stopEvent(t),t.targetTouches.length>0?this.touchMode===W?this.performCross(t):this.touchMode=F:(this.removeDelayActiveCross(),this.touchMode!==W&&(this.touchMode=O,this.kline.tooltipChart.setCross(0,!1),this.kline.freshen(J))))}performDrag(t){let i=this.getCanvasPoint(t.targetTouches[0]),a=i.x-this.touchMovePoint.x;if(a<0-this.dataBounds.dataSpace/2){if(this.dataBounds.min+this.dataBounds.range===this.dataBounds.dataList.length||this.dataBounds.dataList.length<this.dataBounds.range)return!1;this.touchMovePoint.x=i.x;let t=+Math.abs(a/this.dataBounds.dataSpace).toFixed(0);0===t&&(t=1),this.dataBounds.min+=t,this.dataBounds.min>=this.dataBounds.dataList.length-this.dataBounds.range&&(this.dataBounds.min=this.dataBounds.dataList.length-this.dataBounds.range),this.kline.freshen(q)}else if(a>this.dataBounds.dataSpace/2){if(0===this.dataBounds.min||this.dataBounds.dataList.length<this.dataBounds.range)return!1;this.touchMovePoint.x=i.x;let t=+Math.abs(a/this.dataBounds.dataSpace).toFixed(0);0===t&&(t=1),this.dataBounds.min-=t,this.dataBounds.min<=0&&(this.dataBounds.min=0),this.kline.freshen(q)}}performZoom(t){if(t.targetTouches.length>1&&this.spacing(t)>10){let i=this.getXDist(t)/this.savedXDist;if(i<1){if(this.dataBounds.range>=this.dataBounds.maxRange)return!1}else if(this.dataBounds.range<=this.dataBounds.minRange)return!1;this.dataBounds.range=+(this.touchRange/i).toFixed(0),this.dataBounds.range=Math.min(Math.max(this.dataBounds.range,this.dataBounds.minRange),this.dataBounds.maxRange),this.dataBounds.min=this.touchStartPosition+this.touchRange-this.dataBounds.range,this.dataBounds.min+this.dataBounds.range>this.dataBounds.dataList.length&&(this.dataBounds.min=0),this.dataBounds.min<0&&(this.dataBounds.min=0),this.kline.freshen(q)}}performCross(t){let i=this.getCanvasPoint(t.targetTouches[0]);this.touchCrossPoint={x:i.x,y:i.y},this.dataBounds.calcCurrentDataIndex(this.touchCrossPoint.x),this.kline.tooltipChart.setCross(this.touchCrossPoint.y,!0),this.kline.freshen(J)}postDelayDelayActiveCross(){this.delayTimeout=setTimeout(this.delayActiveCross,200)}removeDelayActiveCross(){this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayTimeout=null)}distance(t,i,a,e){let s=t-i,o=a-e;return Math.sqrt(s*s+o*o)}spacing(t){if(t.targetTouches.length<2)return 0;let i=this.getCanvasPoint(t.targetTouches[0]),a=this.getCanvasPoint(t.targetTouches[1]),e=Math.abs(i.x-a.x),s=Math.abs(i.y-a.y);return Math.sqrt(e*e+s*s)}getXDist(t){let i=this.getCanvasPoint(t.targetTouches[0]),a=this.getCanvasPoint(t.targetTouches[1]);return Math.abs(i.x-a.y)}};var j=class extends R{constructor(t,i,a,e){super(t,a,e),this.markData=i}drawLineEnd(){this.markData.markingType=D.NONE,this.markData.markingDatas=[],this.kline.tooltipCanvasDom.style.display=""}drawLineStart(t){this.markData.markingType=t,this.markData.markingDatas=[],this.kline.tooltipCanvasDom.style.display="none"}mouseDown(t){this.stopEvent(t);let i=this.getCanvasPoint(t);if(this.isValidEvent(i))if(0===t.button){if(this.markData.markingType===D.NONE)return this.performHorizontalLineMouseLeftClick(i)||this.performVerticalLineMouseLeftClick(i)?void this.kline.freshen(it):void 0;0===this.markData.markingDatas.length?(this.markData.markingDatas[0]=i,this.kline.freshen(it)):1===this.markData.markingDatas.length?(this.markData.markingType!==D.HORIZONTAL_LINE&&this.markData.markingType!==D.VERTICAL_LINE||(this.markData.markingType===D.HORIZONTAL_LINE?this.markData.horizontalLineDatas.push(i):this.markData.verticalLineDatas.push(i),this.drawLineEnd()),this.kline.freshen(it)):2===this.markData.markingDatas.length&&(this.markData.lineDatas.push({points:[this.markData.markingDatas[0],i]}),this.drawLineEnd(),this.kline.freshen(it))}else if(2===t.button){if(this.markData.markingType!==D.NONE)return this.drawLineEnd(),void this.kline.freshen(it);(this.performHorizontalLineMouseRightClick(i)||this.performVerticalLineMouseRightClick(i))&&this.kline.freshen(it)}}performHorizontalLineMouseLeftClick(t){let i=this.markData.horizontalLineDatas.length;for(let a=0;a<i;a++){let i=this.markData.horizontalLineDatas[a];if(t.y<i.y+10&&t.y>i.y-10&&t.x<i.x+10&&t.x>i.x-10)return this.markData.horizontalLineDatas.splice(a,1),this.drawLineStart(D.HORIZONTAL_LINE),this.markData.markingDatas[0]=t,!0}return!1}performHorizontalLineMouseRightClick(t){let i=this.markData.horizontalLineDatas.length;for(let a=0;a<i;a++){let i=this.markData.horizontalLineDatas[a];if(t.x<i.x+10&&t.x>i.x-10){if(t.y<i.y+10&&t.y>i.y-10&&this.markData.markingType===D.NONE)return this.markData.horizontalLineDatas.splice(a,1),this.drawLineEnd(),!0}else if(t.y<i.y+4&&t.y>i.y-4&&this.markData.markingType===D.NONE)return this.markData.horizontalLineDatas.splice(a,1),this.drawLineEnd(),!0}return!1}performVerticalLineMouseLeftClick(t){let i=this.markData.verticalLineDatas.length;for(let a=0;a<i;a++){let i=this.markData.verticalLineDatas[a];if(t.y<i.y+10&&t.y>i.y-10&&t.x<i.x+10&&t.x>i.x-10)return this.markData.verticalLineDatas.splice(a,1),this.drawLineStart(D.VERTICAL_LINE),this.markData.markingDatas[0]=t,!0}return!1}performVerticalLineMouseRightClick(t){let i=this.markData.verticalLineDatas.length;for(let a=0;a<i;a++){let i=this.markData.verticalLineDatas[a];if(t.y<i.y+10&&t.y>i.y-10){if(t.y<i.x+10&&t.x>i.x-10&&this.markData.markingType===D.NONE)return this.markData.verticalLineDatas.splice(a,1),this.drawLineEnd(),!0}else if(t.x<i.x+4&&t.x>i.x-4&&this.markData.markingType===D.NONE)return this.markData.verticalLineDatas.splice(a,1),this.drawLineEnd(),!0}return!1}mouseUp(t){this.stopEvent(t)}mouseLeave(t){this.stopEvent(t)}mouseMove(t){this.stopEvent(t);let i=this.getCanvasPoint(t);this.isValidEvent(i)&&(this.markData.markingType!==D.NONE||!this.performHorizontalLineEventMove(i)&&!this.performVerticalLineEventMove(i)?0===this.markData.markingDatas.length?(this.markData.startMarkPoint=i,this.kline.freshen(it)):1===this.markData.markingDatas.length?(this.markData.markingType===D.HORIZONTAL_LINE||this.markData.markingType===D.VERTICAL_LINE?this.markData.markingDatas[0]=i:this.markData.markingDatas[1]=i,this.kline.freshen(it)):2===this.markData.markingDatas.length&&(this.markData.markingDatas[1]=i,this.kline.freshen(it)):this.kline.freshen(it))}performHorizontalLineEventMove(t){let i=this.markData.horizontalLineDatas.length,a=!1;for(let e=0;e<i;e++){let i=this.markData.horizontalLineDatas[e];t.x<i.x+10&&t.x>i.x-10?t.y<i.y+10&&t.y>i.y-10&&(this.markData.horizontalLineDatas[e].activeType=A.POINT,a=!0):t.y<i.y+4&&t.y>i.y-4?(this.markData.horizontalLineDatas[e].activeType=A.LINE,a=!0):this.markData.horizontalLineDatas[e].activeType=A.NONE}return a}performVerticalLineEventMove(t){let i=this.markData.verticalLineDatas.length,a=!1;for(let e=0;e<i;e++){let i=this.markData.verticalLineDatas[e];t.y<i.y+10&&t.y>i.y-10?t.x<i.x+10&&t.x>i.x-10&&(this.markData.verticalLineDatas[e].activeType=A.POINT,a=!0):t.x<i.x+4&&t.x>i.x-4?(this.markData.verticalLineDatas[e].activeType=A.LINE,a=!0):this.markData.verticalLineDatas[e].activeType=A.NONE}return a}mouseWheel(t){this.stopEvent(t)}isValidEvent(t){return!(t.x<this.viewPortHandler.contentLeft()||t.x>this.viewPortHandler.contentRight()||t.y<this.viewPortHandler.contentTop()||t.y>this.kline.candleChart.chartTop+this.kline.candleChart.chartHeight)}};async function U(t){let i,a,e,s,o,r=0,n=0;for(let h=0;h<t.length;h++){r+=t[h].turnover,0!==(n+=t[h].volume)&&(t[h].averagePrice=r/n);let l=t[h].close;h<8?(s=G(t.slice(0,h+1)),o=K(t.slice(0,h+1))):(s=G(t.slice(h-8,h+1)),o=K(t.slice(h-8,h+1)));let d=(l-s)/(o-s===0?1:o-s)*100;e=3*(i=2/3*(h<8?50:t[h-1].kdj.k)+1/3*d)-2*(a=2/3*(h<8?50:t[h-1].kdj.d)+1/3*i),t[h].kdj={k:i,d:a,j:e}}return t}function X(t,i){let a=0;for(let o=0;o<t.length;o++){let e=t[o].close-i;a+=e*e}let e=a>0;a=Math.abs(a);let s=Math.sqrt(a/t.length);return e?s:-1*s}function K(t){let i=0;if(t&&t.length>0){let a=t.length;i=t[0].high;for(let e=1;e<a;e++)i=Math.max(t[e].high,i)}return i}function G(t){let i=0;if(t&&t.length>0){let a=t.length;i=t[0].low;for(let e=1;e<a;e++)i=Math.min(t[e].low,i)}return i}const Z="all",J="tooltip",q="chart",$="candle_chart",Q="vol_chart",tt="indicator_chart",it="draw_line_chart";var at=class{constructor(t){this.rootDom=t,this.chartCanvasDom=null,this.chartCanvas=null,this.tooltipCanvasDom=null,this.tooltipCanvas=null,this.markCanvasDom=null,this.markCanvas=null,this.viewPortHandler=new e,this.dataBounds=new s(this.viewPortHandler),this.grid=new B,this.yAxis=new g,this.xAxis=new S,this.candle=new L,this.indicator=new d,this.tooltip=new f,this.gridChart=new r(this.grid,this.dataBounds,this.viewPortHandler),this.candleChart=new w(this.candle,this.indicator,this.yAxis,this.dataBounds,this.viewPortHandler),this.volChart=new p(this.indicator,this.xAxis,this.yAxis,this.dataBounds,this.viewPortHandler,l.VOL),this.indicatorChart=new p(this.indicator,this.xAxis,this.yAxis,this.dataBounds,this.viewPortHandler),this.xAxisChart=new M(this.xAxis,this.dataBounds,this.viewPortHandler),this.tooltipChart=new C(this.tooltip,this.candle,this.indicator,this.yAxis,this.candleChart,this.volChart,this.indicatorChart,this.dataBounds,this.viewPortHandler),this.mark=new H,this.markData=new T,this.markChart=new b(this.mark,this.markData,this.dataBounds,this.viewPortHandler),this.isShouldCalcOffset=!0,this.isShouldCalcChartHeight=!0,this.init()}init(){this.rootDom.style.position="relative",this.chartCanvasDom=document.createElement("canvas"),this.initCanvas(this.chartCanvasDom),this.chartCanvas=this.chartCanvasDom.getContext("2d"),this.markCanvasDom=document.createElement("canvas"),this.initCanvas(this.markCanvasDom),this.markCanvas=this.markCanvasDom.getContext("2d"),this.tooltipCanvasDom=document.createElement("canvas"),this.initCanvas(this.tooltipCanvasDom),this.tooltipCanvas=this.tooltipCanvasDom.getContext("2d"),this.initEvent(),this.resize()}initCanvas(t){t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.bottom="0",t.style.left="0",this.rootDom.appendChild(t)}initEvent(){try{if(/Android|webOS|iPhone|iPod|BlackBerry|UCBrowser/i.test(navigator.userAgent)){let t=new Y(this,this.dataBounds,this.viewPortHandler);this.tooltipCanvasDom.ontouchstart=(i=>{t.touchStart(i)}),this.tooltipCanvasDom.ontouchmove=(i=>{t.touchMove(i)}),this.tooltipCanvasDom.ontouchend=(i=>{t.touchEnd(i)})}else{let t=new V(this,this.dataBounds,this.viewPortHandler);this.markEvent=new j(this,this.markData,this.dataBounds,this.viewPortHandler),this.tooltipCanvasDom.onmousedown=(i=>{t.mouseDown(i),this.markEvent.mouseDown(i)}),this.tooltipCanvasDom.onmouseup=(i=>{t.mouseUp(i)}),this.tooltipCanvasDom.onmousemove=(i=>{t.mouseMove(i),this.markEvent.mouseMove(i)}),this.tooltipCanvasDom.onmouseleave=(i=>{t.mouseLeave(i)}),this.tooltipCanvasDom.onwheel=(i=>{t.mouseWheel(i)}),this.tooltipCanvasDom.oncontextmenu=(()=>!1),this.markCanvasDom.onmousedown=(t=>{this.markEvent.mouseDown(t)}),this.markCanvasDom.onmouseup=(t=>{this.markEvent.mouseUp(t)}),this.markCanvasDom.onmousemove=(t=>{this.markEvent.mouseMove(t)}),this.markCanvasDom.onmouseleave=(t=>{this.markEvent.mouseLeave(t)}),this.markCanvasDom.onwheel=(t=>{this.markEvent.mouseWheel(t)}),this.markCanvasDom.oncontextmenu=(()=>!1)}}catch(t){}}calcChartHeight(t){let i=this.xAxis.getRequiredHeightSpace(),a=t-i,e=this.volChart.isDisplayChart(),s=this.indicatorChart.isDisplayChart(),o=0,r=0;if(e&&s){let t=parseInt(.2*a);o=t,r=t}else e&&!s?o=parseInt(.3*a):!e&&s&&(r=parseInt(.3*a));let n=a-o-r,h=0;this.candleChart.setChartDimens(n,h),this.markChart.setChartDimens(n,h),h+=n,this.volChart.setChartDimens(o,h),h+=o,this.indicatorChart.setChartDimens(r,h),h+=r,this.xAxisChart.setChartDimens(i,h)}calcOffsets(){let t=0,i=0,a=0;if(this.yAxis.needsOffset()){let a=this.yAxis.getRequiredWidthSpace();this.yAxis.yAxisPosition===u.LEFT?t+=a:i+=a}a+=this.xAxis.getRequiredHeightSpace(),this.viewPortHandler.restrainViewPort(t,0,i,a)}setCanvasDomSize(t,i,a){t.width=2*i,t.height=2*a,t.style.width=i+"px",t.style.height=a+"px"}clearCanvasRect(t,i,a){switch(t){case q:this.chartCanvas.clearRect(0,0,2*i,2*a);break;case J:this.tooltipCanvas.clearRect(0,0,2*i,2*a);break;case Z:this.chartCanvas.clearRect(0,0,2*i,2*a),this.tooltipCanvas.clearRect(0,0,2*i,2*a);break;case $:this.tooltipCanvas.clearRect(0,0,2*i,2*a),this.chartCanvas.clearRect(0,this.candleChart.chartTop,2*i,this.candleChart.chartHeight);break;case Q:this.volChart.isDisplayChart()&&this.chartCanvas.clearRect(0,this.volChart.chartTop,2*i,this.volChart.chartHeight);break;case tt:this.indicatorChart.isDisplayChart()&&(this.tooltipCanvas.clearRect(0,0,2*i,2*a),this.chartCanvas.clearRect(0,this.indicatorChart.chartTop,2*i,this.indicatorChart.chartHeight));break;case it:this.markCanvas.clearRect(0,0,2*i,2*a)}}freshen(t=Z){const i=this.rootDom.offsetWidth,a=this.rootDom.offsetHeight;this.clearCanvasRect(t,i,a),this.isShouldCalcChartHeight&&(this.calcChartHeight(2*a),this.isShouldCalcChartHeight=!1),this.isShouldCalcOffset&&(this.setCanvasDomSize(this.chartCanvasDom,i,a),this.setCanvasDomSize(this.markCanvasDom,i,a),this.setCanvasDomSize(this.tooltipCanvasDom,i,a),this.viewPortHandler.setChartDimens(2*i,2*a),this.calcOffsets(),this.isShouldCalcOffset=!1),this.draw(t)}draw(t){this.dataBounds.space(),t===Q?this.volChart.draw(this.chartCanvas):t===tt?(this.indicatorChart.draw(this.chartCanvas),this.tooltipChart.draw(this.tooltipCanvas)):t===$?(this.candleChart.draw(this.chartCanvas),this.tooltipChart.draw(this.tooltipCanvas)):t===it?this.markChart.draw(this.markCanvas):(t!==q&&t!==Z||(this.gridChart.draw(this.chartCanvas),this.xAxisChart.draw(this.chartCanvas),this.candleChart.draw(this.chartCanvas),this.volChart.draw(this.chartCanvas),this.indicatorChart.draw(this.chartCanvas)),t!==J&&t!==Z||this.tooltipChart.draw(this.tooltipCanvas))}async calcIndicator(t,i=q){try{switch(t){case l.MA:this.dataBounds.dataList=await async function(t){let i,a,e,s,o=0,r=0,n=0,h=0,l=0,d=0;for(let c=0;c<t.length;c++){d+=t[c].volume,l+=t[c].turnover||0,0!==d&&(t[c].averagePrice=l/d);let m=t[c].close;o+=m,r+=m,n+=m,h+=m,i=c<5?o/(c+1):(o-=t[c-5].close)/5,a=c<10?r/(c+1):(r-=t[c-10].close)/10,e=c<20?n/(c+1):(n-=t[c-20].close)/20,s=c<60?h/(c+1):(h-=t[c-60].close)/60,t[c].ma={ma5:i,ma10:a,ma20:e,ma60:s}}return t}(this.dataBounds.dataList);break;case l.MACD:this.dataBounds.dataList=await async function(t){let i,a,e=0,s=0,o=0,r=0,n=0,h=0,l=0,d=0;for(let c=0;c<t.length;c++){l+=t[c].turnover,0!==(d+=t[c].volume)&&(t[c].averagePrice=l/d);let m=t[c].close;c>0&&(h=2*((o=(i=(2*m+11*e)/13)-(a=(2*m+25*s)/27))-(r=(2*o+8*n)/10)),e=i,s=a,n=r),t[c].macd={diff:o,dea:r,macd:h}}return t}(this.dataBounds.dataList);break;case l.VOL:this.dataBounds.dataList=await async function(t){let i,a,e,s=0,o=0,r=0,n=0,h=0;for(let l=0;l<t.length;l++){n+=t[l].turnover,0!==(h+=t[l].volume)&&(t[l].averagePrice=n/h);let d=t[l].volume;s+=d,o+=d,r+=d,i=l<5?s/(l+1):(s-=t[l-5].volume)/5,a=l<10?o/(l+1):(o-=t[l-10].volume)/10,e=l<20?r/(l+1):(r-=t[l-20].volume)/20,t[l].vol={num:d,ma5:i,ma10:a,ma20:e}}return t}(this.dataBounds.dataList);break;case l.BOLL:this.dataBounds.dataList=await async function(t){let i,a,e,s,o,r=0,n=0,h=0,l=0;for(let d=0;d<t.length;d++){h+=t[d].turnover,0!==(l+=t[d].volume)&&(t[d].averagePrice=h/l);let c=t[d].close;r+=c,n+=c,d>=24?(a=n/25,n-=t[d-24].close):a=n/(d+1),d>=25?(i=r/26,e=X(t.slice(d-25,d+1),i),r-=t[d-25].close):(i=r/(d+1),e=X(t.slice(0,d+1),i)),s=a+2*e,o=a-2*e,t[d].boll={up:s,mid:i,dn:o}}return t}(this.dataBounds.dataList);break;case l.BIAS:this.dataBounds.dataList=await async function(t){let i,a,e,s=0,o=0,r=0,n=0,h=0;for(let l=0;l<t.length;l++){n+=t[l].turnover,0!==(h+=t[l].volume)&&(t[l].averagePrice=n/h);let d=t[l].close;if(s+=d,o+=d,r+=d,l<6){let t=s/(l+1);i=(d-t)/t*100}else{let a=(s-=t[l-6].close)/6;i=(d-a)/a*100}if(l<12){let t=o/(l+1);a=(d-t)/t*100}else{let i=(o-=t[l-12].close)/12;a=(d-i)/i*100}if(l<24){let t=r/(l+1);e=(d-t)/t*100}else{let i=(r-=t[l-24].close)/24;e=(d-i)/i*100}t[l].bias={bias1:i,bias2:a,bias3:e}}return t}(this.dataBounds.dataList);break;case l.BRAR:this.dataBounds.dataList=await async function(t){let i=0,a=0,e=0,s=0,o=0,r=0,n=0,h=0;for(let l=0;l<t.length;l++){n+=t[l].turnover,0!==(h+=t[l].volume)&&(t[l].averagePrice=n/h);let d=t[l].high,c=t[l].low,m=t[l].open;if(o+=d-m,r+=m-c,l>25&&(o-=t[l-26].high-t[l-26].open,r-=t[l-26].open-t[l-26].low),0!==r&&(a=o/r*100),l>0){let a=t[l-1].close,o=d-a;o<0&&(o=0),e+=o;let r=a-c;r<0&&(r=0),0!==(s+=r)&&(i=e/s*100)}t[l].brar={br:i,ar:a}}return t}(this.dataBounds.dataList);break;case l.CCI:this.dataBounds.dataList=await async function(t){let i,a=0,e=0,s=0;for(let o=0;o<t.length;o++){e+=t[o].turnover,0!==(s+=t[o].volume)&&(t[o].averagePrice=e/s);let r=(t[o].high+t[o].low+t[o].close)/3;if(a+=r,o>=13){let e=a/14;a-=(t[o-13].high+t[o-13].low+t[o-13].close)/3;let s=0;for(let i=o-13;i<o+1;i++){let a=(t[i].high+t[i].low+t[i].close)/3;s+=Math.abs(a-e)}let n=s/14;i=0===n?0:200*(r-e)/3/n}else{let e=a/(o+1),s=0;for(let i=0;i<o+1;i++){let a=(t[i].high+t[i].low+t[i].close)/3;s+=Math.abs(a-e)}let n=s/(o+1);i=0===n?0:200*(r-e)/3/n}t[o].cci={cci:i}}return t}(this.dataBounds.dataList);break;case l.CR:this.dataBounds.dataList=await async function(t){let i,a,e,s,o,r,n,h,l=0,d=0,c=0,m=0,u=[],x=0,g=[],v=0,p=[],k=0,y=[],L=0,w=0;for(let M=0;M<t.length;M++){if(L+=t[M].turnover,0!==(w+=t[M].volume)&&(t[M].averagePrice=L/w),M>0){let i=t[M-1].high,a=t[M-1].low,e=(i+t[M-1].close+a+t[M-1].open)/4,s=t[M].high,o=t[M].low,r=s-e;r<0&&(r=0),d+=r;let n=e-o;if(n<0&&(n=0),c+=n,M>26){let i=(t[M-27].high+t[M-27].low+t[M-27].close+t[M-27].open)/4,a=t[M-26].high,e=t[M-26].low,s=a-i;s<0&&(s=0);let o=i-e;o<0&&(o=0),d-=s,c-=o}0!==c&&(l=d/c*100);let h=(t[M-1].high+t[M-1].low+t[M-1].close)/3,m=t[M].high-h;d+=m<=0?0:m;let u=h-t[M].low;c+=u<=0?0:u}m+=l,x+=l,v+=l,k+=l,o=M<10?m/(M+1):(m-=t[M-10].cr.cr)/10,u.push(o),r=M<20?x/(M+1):(x-=t[M-20].cr.cr)/20,g.push(r),n=M<40?v/(M+1):(v-=t[M-40].cr.cr)/40,p.push(n),h=M<60?k/(M+1):(k-=t[M-60].cr.cr)/60,y.push(h),i=M<5?u[0]:u[M-5],a=M<9?g[0]:g[M-9],e=M<17?p[0]:p[M-17],s=M<25?y[0]:y[M-25],t[M].cr={cr:l,ma1:i,ma2:a,ma3:e,ma4:s}}return t}(this.dataBounds.dataList);break;case l.DMA:this.dataBounds.dataList=await async function(t){let i,a,e,s,o=0,r=0,n=0,h=0,l=0;for(let d=0;d<t.length;d++){h+=t[d].turnover,0!==(l+=t[d].volume)&&(t[d].averagePrice=h/l);let c=t[d].close;o+=c,r+=c,n+=i=(e=d<10?o/(d+1):(o-=t[d-10].close)/10)-(s=d<50?r/(d+1):(r-=t[d-50].close)/50),a=d<10?n/(d+1):(n-=t[d-10].dma.dif)/10,t[d].dma={dif:i,difMa:a}}return t}(this.dataBounds.dataList);break;case l.DMI:this.dataBounds.dataList=await async function(t){let i,a,e,s=0,o=0,r=0,n=0,h=[],l=[],d=[],c=[],m=[],u=0,x=0;for(let g=0;g<t.length;g++){if(u+=t[g].turnover,0!==(x+=t[g].volume)&&(t[g].averagePrice=u/x),g>0){e=t[g-1].close,i=t[g].high-t[g-1].high,a=t[g-1].low-t[g].low;let u,x,v=t[g].high-t[g].low>Math.abs(t[g].high-e)?t[g].high-t[g].low:Math.abs(t[g].high-e),p=v>Math.abs(e)-t[g].low?v:Math.abs(e)-t[g].low;h.push(p),u=i>0&&i>a?i:0,l.push(u),x=a>0&&a>i?a:0,d.push(x);let k=0,y=0,L=0;for(let t=0;t<h.length;t++)k+=h[t],y+=l[t],L+=d[t];s=100*y/k,o=100*L/k;let w=Math.abs(o-s)/(o+s)*100;c.push(w);let M=0;for(let t=0;t<c.length;t++)M+=c[t];r=M/6,m.push(r);let P=0;P+=m[0],n=(P+=m[m.length-1])/2,g>=14&&(h.splice(0,1),l.splice(0,1),d.splice(0,1)),g>=19&&c.splice(0,1),g>=25&&m.splice(0,1)}t[g].dmi={pdi:s,mdi:o,adx:r,adxr:n}}return t}(this.dataBounds.dataList);break;case l.KDJ:case l.KD:this.dataBounds.dataList=await U(this.dataBounds.dataList);break;case l.RSI:this.dataBounds.dataList=await async function(t){let i,a,e,s,o,r,n=0,h=0,l=0,d=0,c=0,m=0,u=0,x=0,g=0,v=0,p=0,k=0,y=0;for(let L=0;L<t.length;L++){if(k+=t[L].turnover,0!==(y+=t[L].volume)&&(t[L].averagePrice=k/y),L>0){let k=t[L].close-t[L-1].close;k>0?d+=k:c+=k;let y=k>0?k:0,w=Math.abs(k);L<6?(i=d/(L+1),a=(Math.abs(c)+d)/(L+1)):(i=(y+5*m)/6,a=(w+5*u)/6),m=i,u=a,n=i/a*100,L<12?(e=d/(L+1),s=(Math.abs(c)+d)/(L+1)):(e=(y+11*x)/12,s=(w+11*g)/12),x=e,g=s,h=e/s*100,L<24?(o=d/(L+1),r=(Math.abs(c)+d)/(L+1)):(o=(y+23*v)/24,r=(w+23*p)/24),v=o,p=r,l=o/r*100}t[L].rsi={rsi1:n,rsi2:h,rsi3:l}}return t}(this.dataBounds.dataList);break;case l.PSY:this.dataBounds.dataList=await async function(t){let i=0,a=0,e=0,s=0;for(let o=0;o<t.length;o++)e+=t[o].turnover,0!==(s+=t[o].volume)&&(t[o].averagePrice=e/s),o>0&&(a+=t[o].close-t[o-1].close>0?1:0,o>=12?(i=a/12*100,a-=t[o-11].close-t[o-12].close>0?1:0):i=a/o*100),t[o].psy={psy:i};return t}(this.dataBounds.dataList);break;case l.TRIX:this.dataBounds.dataList=await async function(t){let i,a,e,s,o=0,r=0,n=0,h=0,l=0,d=0,c=0,m=0,u=0,x=0;for(let g=0;g<t.length;g++){u+=t[g].turnover,0!==(x+=t[g].volume)&&(t[g].averagePrice=u/x);let v=t[g].close;n+=v,h=a=g<12?n/(g+1):(2*v+11*h)/13,l+=a,d=e=g<12?l/(g+1):(2*a+11*d)/13,c+=e,s=g<12?c/(g+1):(2*e+11*m)/13,0!==m&&(o=(s-m)/m*100),r+=o,m=s,g<20?i=r/(g+1):(i=r/20,r-=t[g-19].trix.trix),t[g].trix={trix:o,maTrix:i}}return t}(this.dataBounds.dataList);break;case l.OBV:this.dataBounds.dataList=await async function(t){let i,a=0,e=0,s=0;for(let o=0;o<t.length;o++){e+=t[o].turnover,0!==(s+=t[o].volume)&&(t[o].averagePrice=e/s);let r=t[o].close,n=t[o].high,h=n-r,l=t[o].volume*(r-t[o].low-h)/n;a+=l,i=o<30?a/(o+1):(a-=t[o-30].obv.obv)/30,t[o].obv={obv:l,maObv:i}}return t}(this.dataBounds.dataList);break;case l.VR:this.dataBounds.dataList=await async function(t){let i,a=0,e=0,s=0,o=0,r=0,n=0,h=0;for(let l=0;l<t.length;l++){if(n+=t[l].turnover,0!==(h+=t[l].volume)&&(t[l].averagePrice=n/h),l<24){let i=t[l].close,o=t[l].open,r=t[l].volume;i>o?a+=r:i<o?e+=r:s+=r}else for(let i=l-24;i<l;i++){let o=t[i].close,r=t[i].open,n=t[i].volume;i===l-24&&(a=0,e=0,s=0),o>r?a+=n:o<r?e+=n:s+=n}let d=e+.5*s;0!==d&&(o=(a+.5*s)/d*100),r+=o,i=l<30?r/(l+1):(r-=t[l-30].vr.vr)/30,t[l].vr={vr:o,maVr:i}}return t}(this.dataBounds.dataList);break;case l.WR:this.dataBounds.dataList=await async function(t){let i=0,a=0,e=0,s=Number.MIN_VALUE,o=Number.MAX_VALUE,r=Number.MIN_VALUE,n=Number.MAX_VALUE,h=Number.MIN_VALUE,l=Number.MAX_VALUE,d=0,c=0;for(let m=0;m<t.length;m++){d+=t[m].turnover,0!==(c+=t[m].volume)&&(t[m].averagePrice=d/c);let u=t[m].close;if(m<13){let d=t[m].high,c=t[m].low;s=Math.max(d,s),o=Math.min(c,o),r=Math.max(d,r),n=Math.min(c,n),h=Math.max(d,h),l=Math.min(c,l);let x=s-o;0!==x&&(i=(s-u)/x*100),a=i,e=i}else{for(let a=m-13;a<m;a++){a===m-13?(s=t[a].high,o=t[a].low):(s=Math.max(t[a].high,s),o=Math.min(t[a].low,o));let e=s-o;0!==e&&(i=(s-u)/e*100)}if(m<34){let i=t[m].high,s=t[m].low;r=Math.max(i,r),n=Math.min(s,n),h=Math.max(i,h),l=Math.min(s,l);let o=r-n;0!==o&&(a=(r-u)/o*100),e=a}else{for(let i=m-34;i<m;i++){i===m-34?(r=t[i].high,n=t[i].low):(r=Math.max(t[i].high,r),n=Math.min(t[i].low,n));let e=r-n;0!==e&&(a=(r-u)/e*100)}if(m<89){let i=t[m].high,a=t[m].low,s=(h=Math.max(i,h))-(l=Math.min(a,l));0!==s&&(e=(h-u)/s*100)}else for(let i=m-89;i<m;i++){i===m-89?(h=t[i].high,l=t[i].low):(h=Math.max(t[i].high,h),l=Math.min(t[i].low,l));let a=h-l;0!==a&&(e=(h-u)/a*100)}}}t[m].wr={wr1:i,wr2:a,wr3:e}}return t}(this.dataBounds.dataList);break;case l.MTM:this.dataBounds.dataList=await async function(t){let i,a,e=0,s=0,o=0;for(let r=0;r<t.length;r++){s+=t[r].turnover,0!==(o+=t[r].volume)&&(t[r].averagePrice=s/o);let n=t[r].close;e+=i=r<6?n-t[0].close:n-t[r-6].close,a=r<10?e/(r+1):(e-=t[r-10].mtm.mtm)/10,t[r].mtm={mtm:i,mtmMa:a}}return t}(this.dataBounds.dataList);break;case l.EMV:this.dataBounds.dataList=await async function(t){let i,a=0,e=0,s=0,o=[],r=0,n=0;for(let h=0;h<t.length;h++){let l=t[h].turnover;if(r+=l,0!==(n+=t[h].volume)&&(t[h].averagePrice=r/n),h>0){let i=t[h].high,a=t[h].low;s=((i+a)/2-(t[h-1].high+t[h-1].low)/2)*(i-a)/l}o.push(s),h<14?a+=s:a-=o[h-14],e+=a,i=h<9?e/(h+1):(e-=t[h-9].emv.emv)/9,t[h].emv={emv:a,maEmv:i}}return t}(this.dataBounds.dataList);break;case l.SAR:this.dataBounds.dataList=await async function(t){let i=0,a=-100,e=!1,s=0,o=0,r=0;for(let n=0;n<t.length;n++){o+=t[n].turnover,0!==(r+=t[n].volume)&&(t[n].averagePrice=o/r);let h=s,l=t[n].high,d=t[n].low;if(e){(-100===a||a<l)&&(a=l,i=Math.min(i+.02,2)),s=h+i*(a-h);let o=Math.min(t[Math.max(1,n)-1].low,d);s>t[n].low?(s=a,i=0,a=-100,e=!e):s>o&&(s=o)}else{(-100===a||a>d)&&(a=d,i=Math.min(i+.02,.2)),s=h+i*(a-h);let o=Math.max(t[Math.max(1,n)-1].high,l);s<t[n].high?(s=a,i=0,a=-100,e=!e):s<o&&(s=o)}t[n].sar={sar:s}}return t}(this.dataBounds.dataList)}this.freshen(i)}catch(a){}}calcChartIndicator(){let t=this.candleChart.isDisplayChart(),i=this.volChart.isDisplayChart(),a=this.indicatorChart.isDisplayChart();t&&this.calcIndicator(this.candleChart.indicatorType),i&&this.calcIndicator(l.VOL),a&&this.calcIndicator(this.indicatorChart.indicatorType)}checkData(t){if("object"!==typeof t||null===t.open||void 0===t.open||null===t.close||void 0===t.close||null===t.high||void 0===t.high||null===t.low||void 0===t.low||null===t.timestamp||void 0===t.timestamp||null===t.volume||void 0===t.volume||null===t.turnover||void 0===t.turnover)throw new Error("The data must be object and need to contain open, close, high, low, timestamp, volume, and turnover fields")}resize(){this.isShouldCalcOffset=!0,this.freshen()}setConfig(t){if(t){let i=t.common;i&&(i.minVisibleRange>0&&(this.dataBounds.minRange=i.minVisibleRange),i.maxVisibleRange>0&&i.maxVisibleRange>this.dataBounds.minRange&&(this.dataBounds.maxRange=i.maxVisibleRange),i.defaultVisibleRange>0&&i.defaultVisibleRange>this.dataBounds.minRange-1&&i.defaultVisibleRange<this.dataBounds.maxRange+1&&(this.dataBounds.range=i.defaultVisibleRange));let a=t.grid;a&&(void 0!==a.display&&(this.grid.display=a.display),a.lineSize>0&&(this.grid.lineSize=a.lineSize),a.lineColor&&(this.grid.lineColor=a.lineColor));let e=t.candle;e&&(e.chartType&&(this.candle.chartStyle=e.chartType),e.timeChart&&(this.candle.timeChart={...this.candle.timeChart,...e.timeChart}),e.candleChart&&(this.candle.candleChart={...this.candle.candleChart,...e.candleChart}),e.lowestHighestPriceMarkTextColor&&(this.candle.lowestHighestPriceMarkTextColor=e.lowestHighestPriceMarkTextColor),e.lowestHighestPriceMarkTextSize>0&&(this.candle.lowestHighestPriceMarkTextSize=e.lowestHighestPriceMarkTextSize),this.candle.lowestHighestValueFormatter=e.lowestHighestValueFormatter,e.highestPriceMark&&(this.candle.highestPriceMark={...this.candle.highestPriceMark,...e.highestPriceMark}),e.lowestPriceMark&&(this.candle.lowestPriceMark={...this.candle.lowestPriceMark,...e.lowestPriceMark}),e.lastPriceMark&&(this.candle.lastPriceMark={...this.candle.lastPriceMark,...e.lastPriceMark}));let s=t.indicator;s&&(s.lineSize>0&&(this.indicator.lineSize=s.lineSize),s.increasingColor&&(this.indicator.increasingColor=s.increasingColor),s.decreasingColor&&(this.indicator.decreasingColor=s.decreasingColor),s.lineColors&&s.lineColors.length>4&&(this.indicator.lineColors=s.lineColors));let o=t.xAxis;o&&(null!==o.display&&void 0!==o.display&&(this.xAxis.display=o.display),this.xAxis.color&&(this.xAxis.color=o.color),o.minHeight>=0&&(this.xAxis.xAxisMinHeight=o.minHeight),o.maxHeight>=0&&o.maxHeight>=this.xAxis.xAxisMinHeight&&(this.xAxis.xAxisMaxHeight=o.maxHeight),o.axisLine&&(this.xAxis.axisLine={...this.xAxis.axisLine,...o.axisLine}),o.tickText&&(this.xAxis.tickText={...this.xAxis.tickText,...o.tickText}),o.tickLine&&(this.xAxis.tickLine={...this.xAxis.tickLine,...o.tickLine}),o.separatorLine&&(this.xAxis.separatorLine={...this.xAxis.separatorLine,...o.separatorLine}));let r=t.yAxis;r&&(null!==r.display&&void 0!==r.display&&(this.yAxis.display=r.display),r.position&&(this.yAxis.yAxisPosition=r.position,this.isShouldCalcOffset=!0),this.yAxis.color&&(this.yAxis.color=r.color),r.minWidth>=0&&(this.yAxis.yAxisMinWidth=r.minWidth),r.maxWidth>=0&&r.maxWidth>=this.yAxis.yAxisMinWidth&&(this.yAxis.yAxisMaxWidth=r.maxWidth),r.axisLine&&(this.yAxis.axisLine={...this.yAxis.axisLine,...r.axisLine}),r.tickText&&(this.yAxis.tickText={...this.yAxis.tickText,...r.tickText},this.isShouldCalcOffset=!0),r.tickLine&&(this.yAxis.tickLine={...this.yAxis.tickLine,...r.tickLine}),r.separatorLine&&(this.yAxis.separatorLine={...this.yAxis.separatorLine,...r.separatorLine}));let n=t.tooltip;n&&(n.textSize>0&&(this.tooltip.textSize=n.textSize),n.crossLine&&(null!==n.crossLine.display&&void 0!==n.crossLine.display&&(this.tooltip.crossLine.display=r.display),n.crossLine.text&&(n.crossLine.text={...this.tooltip.crossLine.text,...n.crossLine.text}),this.tooltip.crossLine={...this.tooltip.crossLine,...n.crossLine}),n.generalData&&(n.generalData.text&&(n.generalData.text={...this.tooltip.generalData.text,...n.generalData.text}),this.tooltip.generalData={...this.tooltip.generalData,...n.generalData}),n.indicatorData&&(n.indicatorData.text&&(n.indicatorData.text={...this.tooltip.indicatorData.text,...n.indicatorData.text}),this.tooltip.indicatorData={...this.tooltip.indicatorData,...n.indicatorData}));let h=t.mark;h&&(h.line&&(h.line.highlight&&(h.line.highlight={...this.mark.line.highlight,...h.line.highlight}),this.mark.line={...this.mark.line,...h.line}),h.point&&(h.point.highlight&&(h.point.highlight={...this.mark.point.highlight,...h.point.highlight}),this.mark.point={...this.mark.point,...h.point})),this.freshen()}}setDataList(t){if(t&&Array.isArray(t)){for(let i=0;i<t.length;i++)this.checkData(t[i]);this.dataBounds.dataList=t,this.dataBounds.moveToLast(),this.calcChartIndicator()}}addData(t,i=this.dataBounds.dataList.length){this.checkData(t),this.dataBounds.dataList[i]=t,this.dataBounds.min+this.dataBounds.range>=this.dataBounds.dataList.length-1&&this.dataBounds.moveToLast(),this.calcChartIndicator()}setMainIndicatorType(t){this.candleChart.indicatorType!==t&&(this.candleChart.indicatorType=t,this.calcIndicator(t,$))}setSubIndicatorType(t){if(this.indicatorChart.indicatorType!==t){let i=this.indicatorChart.isDisplayChart()&&t===l.NO||!this.indicatorChart.isDisplayChart()&&t!==l.NO;this.indicatorChart.indicatorType=t,i&&(this.isShouldCalcChartHeight=!0),this.calcIndicator(t),this.freshen(this.isShouldCalcChartHeight?Z:tt)}}setShowVolIndicatorChart(t){this.volChart.isDisplayChart()!==t&&(t?(this.volChart.indicatorType=l.VOL,this.calcIndicator(l.VOL)):this.volChart.indicatorType=l.NO,this.isShouldCalcChartHeight=!0,this.freshen(Q))}markLine(t){this.markEvent.drawLineStart(t)}};const et={IndicatorType:l,LineStyle:c,YAxisTextPosition:x,YAxisPosition:u,CandleStyle:k,ChartStyle:y,IndicatorDisplayRule:P,init:t=>new at(t),version:()=>"1.1.2"};i.default=et}]).default});